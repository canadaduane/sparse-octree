!function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t,e,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function h(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var c=function(){function t(){n(this,t),this.listenerFunctions=new Map,this.listenerObjects=new Map}return o(t,[{key:"addEventListener",value:function(t,e){var n="function"==typeof e?this.listenerFunctions:this.listenerObjects;n.has(t)?n.get(t).add(e):n.set(t,new Set([e]))}},{key:"removeEventListener",value:function(t,e){var n="function"==typeof e?this.listenerFunctions:this.listenerObjects;if(n.has(t)){var i=n.get(t);i.delete(e),0===i.size&&n.delete(t)}}},{key:"dispatchEvent",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,i=n.listenerFunctions,o=n.listenerObjects;if(t.target=n,i.has(t.type)){e=i.get(t.type);var r=!0,s=!1,a=void 0;try{for(var l,u=e[Symbol.iterator]();!(r=(l=u.next()).done);r=!0)l.value.call(n,t)}catch(t){s=!0,a=t}finally{try{r||null==u.return||u.return()}finally{if(s)throw a}}}if(o.has(t.type)){e=o.get(t.type);var h=!0,c=!1,d=void 0;try{for(var f,m=e[Symbol.iterator]();!(h=(f=m.next()).done);h=!0)f.value.handleEvent(t)}catch(t){c=!0,d=t}finally{try{h||null==m.return||m.return()}finally{if(c)throw d}}}}}]),t}();function d(t,e){var n=t.__state.conversionName.toString(),i=Math.round(t.r),o=Math.round(t.g),r=Math.round(t.b),s=t.a,a=Math.round(t.h),l=t.s.toFixed(1),u=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var h=t.hex.toString(16);h.length<6;)h="0"+h;return"#"+h}return"CSS_RGB"===n?"rgb("+i+","+o+","+r+")":"CSS_RGBA"===n?"rgba("+i+","+o+","+r+","+s+")":"HEX"===n?"0x"+t.hex.toString(16):"RGB_ARRAY"===n?"["+i+","+o+","+r+"]":"RGBA_ARRAY"===n?"["+i+","+o+","+r+","+s+"]":"RGB_OBJ"===n?"{r:"+i+",g:"+o+",b:"+r+"}":"RGBA_OBJ"===n?"{r:"+i+",g:"+o+",b:"+r+",a:"+s+"}":"HSV_OBJ"===n?"{h:"+a+",s:"+l+",v:"+u+"}":"HSVA_OBJ"===n?"{h:"+a+",s:"+l+",v:"+u+",a:"+s+"}":"unknown format"}var f=Array.prototype.forEach,m=Array.prototype.slice,p={BREAK:{},extend:function(t){return this.each(m.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(e[n])||(t[n]=e[n])}.bind(this))}),this),t},defaults:function(t){return this.each(m.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(t[n])&&(t[n]=e[n])}.bind(this))}),this),t},compose:function(){var t=m.call(arguments);return function(){for(var e=m.call(arguments),n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},each:function(t,e,n){if(t)if(f&&t.forEach&&t.forEach===f)t.forEach(e,n);else if(t.length===t.length+0){var i,o=void 0;for(o=0,i=t.length;o<i;o++)if(o in t&&e.call(n,t[o],o)===this.BREAK)return}else for(var r in t)if(e.call(n,t[r],r)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var i=void 0;return function(){var o=this,r=arguments;function s(){i=null,n||t.apply(o,r)}var a=n||!i;clearTimeout(i),i=setTimeout(s,e),a&&t.apply(o,r)}},toArray:function(t){return t.toArray?t.toArray():m.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return"[object Function]"===Object.prototype.toString.call(t)}},y=[{litmus:p.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:d},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:d},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:d},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:d}}},{litmus:p.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:p.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:p.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(p.isNumber(t.r)&&p.isNumber(t.g)&&p.isNumber(t.b)&&p.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(p.isNumber(t.r)&&p.isNumber(t.g)&&p.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(p.isNumber(t.h)&&p.isNumber(t.s)&&p.isNumber(t.v)&&p.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(p.isNumber(t.h)&&p.isNumber(t.s)&&p.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],v=void 0,g=void 0,_=function(){g=!1;var t=arguments.length>1?p.toArray(arguments):arguments[0];return p.each(y,(function(e){if(e.litmus(t))return p.each(e.conversions,(function(e,n){if(v=e.read(t),!1===g&&!1!==v)return g=v,v.conversionName=n,v.conversion=e,p.BREAK})),p.BREAK})),g},b=void 0,x={hsv_to_rgb:function(t,e,n){var i=Math.floor(t/60)%6,o=t/60-Math.floor(t/60),r=n*(1-e),s=n*(1-o*e),a=n*(1-(1-o)*e),l=[[n,a,r],[s,n,r],[r,n,a],[r,s,n],[a,r,n],[n,r,s]][i];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,n){var i=Math.min(t,e,n),o=Math.max(t,e,n),r=o-i,s=void 0;return 0===o?{h:NaN,s:0,v:0}:(s=t===o?(e-n)/r:e===o?2+(n-t)/r:4+(t-e)/r,(s/=6)<0&&(s+=1),{h:360*s,s:r/o,v:o/255})},rgb_to_hex:function(t,e,n){var i=this.hex_with_component(0,2,t);return i=this.hex_with_component(i,1,e),i=this.hex_with_component(i,0,n)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,n){return n<<(b=8*e)|t&~(255<<b)}},k="function"==typeof Symbol&&"symbol"===e(Symbol.iterator)?function(t){return e(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":e(t)},w=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},A=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),E=function t(e,n,i){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,n,i)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(i):void 0},S=function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+e(n));t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)},C=function(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!==e(n)&&"function"!=typeof n?t:n},M=function(){function t(){if(w(this,t),this.__state=_.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return A(t,[{key:"toString",value:function(){return d(this)}},{key:"toHexString",value:function(){return d(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function z(t,e,n){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space?this.__state[e]:(M.recalculateRGB(this,e,n),this.__state[e])},set:function(t){"RGB"!==this.__state.space&&(M.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=t}})}function O(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space?this.__state[e]:(M.recalculateHSV(this),this.__state[e])},set:function(t){"HSV"!==this.__state.space&&(M.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}M.recalculateRGB=function(t,e,n){if("HEX"===t.__state.space)t.__state[e]=x.component_from_hex(t.__state.hex,n);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");p.extend(t.__state,x.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},M.recalculateHSV=function(t){var e=x.rgb_to_hsv(t.r,t.g,t.b);p.extend(t.__state,{s:e.s,v:e.v}),p.isNaN(e.h)?p.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},M.COMPONENTS=["r","g","b","h","s","v","hex","a"],z(M.prototype,"r",2),z(M.prototype,"g",1),z(M.prototype,"b",0),O(M.prototype,"h"),O(M.prototype,"s"),O(M.prototype,"v"),Object.defineProperty(M.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(M.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=x.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var P=function(){function t(e,n){w(this,t),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return A(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),T={};p.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){p.each(t,(function(t){T[t]=e}))}));var L=/(\d+(\.\d+)?)px/;function D(t){if("0"===t||p.isUndefined(t))return 0;var e=t.match(L);return p.isNull(e)?0:parseFloat(e[1])}var F={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,n){var i=n,o=e;p.isUndefined(o)&&(o=!0),p.isUndefined(i)&&(i=!0),t.style.position="absolute",o&&(t.style.left=0,t.style.right=0),i&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,n,i){var o=n||{},r=T[e];if(!r)throw new Error("Event type "+e+" not supported.");var s=document.createEvent(r);switch(r){case"MouseEvents":var a=o.x||o.clientX||0,l=o.y||o.clientY||0;s.initMouseEvent(e,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,a,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var u=s.initKeyboardEvent||s.initKeyEvent;p.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),u(e,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:s.initEvent(e,o.bubbles||!1,o.cancelable||!0)}p.defaults(s,i),t.dispatchEvent(s)},bind:function(t,e,n,i){var o=i||!1;return t.addEventListener?t.addEventListener(e,n,o):t.attachEvent&&t.attachEvent("on"+e,n),F},unbind:function(t,e,n,i){var o=i||!1;return t.removeEventListener?t.removeEventListener(e,n,o):t.detachEvent&&t.detachEvent("on"+e,n),F},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var n=t.className.split(/ +/);-1===n.indexOf(e)&&(n.push(e),t.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return F},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var n=t.className.split(/ +/),i=n.indexOf(e);-1!==i&&(n.splice(i,1),t.className=n.join(" "))}else t.className=void 0;return F},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return D(e["border-left-width"])+D(e["border-right-width"])+D(e["padding-left"])+D(e["padding-right"])+D(e.width)},getHeight:function(t){var e=getComputedStyle(t);return D(e["border-top-width"])+D(e["border-bottom-width"])+D(e["padding-top"])+D(e["padding-bottom"])+D(e.height)},getOffset:function(t){var e=t,n={left:0,top:0};if(e.offsetParent)do{n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent}while(e);return n},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},R=function(t){function e(t,n){w(this,e);var i=C(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=i;return i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox"),F.bind(i.__checkbox,"change",(function(){o.setValue(!o.__prev)}),!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return S(e,t),A(e,[{key:"setValue",value:function(t){var n=E(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),E(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(P),B=function(t){function e(t,n,i){w(this,e);var o=C(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i,s=o;if(o.__select=document.createElement("select"),p.isArray(r)){var a={};p.each(r,(function(t){a[t]=t})),r=a}return p.each(r,(function(t,e){var n=document.createElement("option");n.innerHTML=e,n.setAttribute("value",t),s.__select.appendChild(n)})),o.updateDisplay(),F.bind(o.__select,"change",(function(){var t=this.options[this.selectedIndex].value;s.setValue(t)})),o.domElement.appendChild(o.__select),o}return S(e,t),A(e,[{key:"setValue",value:function(t){var n=E(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return F.isActive(this.__select)?this:(this.__select.value=this.getValue(),E(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(P),N=function(t){function e(t,n){w(this,e);var i=C(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=i;function r(){o.setValue(o.__input.value)}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),F.bind(i.__input,"keyup",r),F.bind(i.__input,"change",r),F.bind(i.__input,"blur",(function(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())})),F.bind(i.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return S(e,t),A(e,[{key:"updateDisplay",value:function(){return F.isActive(this.__input)||(this.__input.value=this.getValue()),E(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(P);function H(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var V=function(t){function e(t,n,i){w(this,e);var o=C(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i||{};return o.__min=r.min,o.__max=r.max,o.__step=r.step,p.isUndefined(o.__step)?0===o.initialValue?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=H(o.__impliedStep),o}return S(e,t),A(e,[{key:"setValue",value:function(t){var n=t;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),E(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=H(t),this}}]),e}(P);var j=function(t){function e(t,n,i){w(this,e);var o=C(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i));o.__truncationSuspended=!1;var r=o,s=void 0;function a(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function l(t){var e=s-t.clientY;r.setValue(r.getValue()+e*r.__impliedStep),s=t.clientY}function u(){F.unbind(window,"mousemove",l),F.unbind(window,"mouseup",u),a()}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),F.bind(o.__input,"change",(function(){var t=parseFloat(r.__input.value);p.isNaN(t)||r.setValue(t)})),F.bind(o.__input,"blur",(function(){a()})),F.bind(o.__input,"mousedown",(function(t){F.bind(window,"mousemove",l),F.bind(window,"mouseup",u),s=t.clientY})),F.bind(o.__input,"keydown",(function(t){13===t.keyCode&&(r.__truncationSuspended=!0,this.blur(),r.__truncationSuspended=!1,a())})),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return S(e,t),A(e,[{key:"updateDisplay",value:function(){var t,n,i;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),n=this.__precision,i=Math.pow(10,n),Math.round(t*i)/i),E(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(V);function U(t,e,n,i,o){return i+(t-e)/(n-e)*(o-i)}var I=function(t){function e(t,n,i,o,r){w(this,e);var s=C(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,{min:i,max:o,step:r})),a=s;function l(t){t.preventDefault();var e=a.__background.getBoundingClientRect();return a.setValue(U(t.clientX,e.left,e.right,a.__min,a.__max)),!1}function u(){F.unbind(window,"mousemove",l),F.unbind(window,"mouseup",u),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function h(t){var e=t.touches[0].clientX,n=a.__background.getBoundingClientRect();a.setValue(U(e,n.left,n.right,a.__min,a.__max))}function c(){F.unbind(window,"touchmove",h),F.unbind(window,"touchend",c),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),F.bind(s.__background,"mousedown",(function(t){document.activeElement.blur(),F.bind(window,"mousemove",l),F.bind(window,"mouseup",u),l(t)})),F.bind(s.__background,"touchstart",(function(t){if(1!==t.touches.length)return;F.bind(window,"touchmove",h),F.bind(window,"touchend",c),h(t)})),F.addClass(s.__background,"slider"),F.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return S(e,t),A(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",E(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(V),q=function(t){function e(t,n,i){w(this,e);var o=C(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=o;return o.__button=document.createElement("div"),o.__button.innerHTML=void 0===i?"Fire":i,F.bind(o.__button,"click",(function(t){return t.preventDefault(),r.fire(),!1})),F.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return S(e,t),A(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(P),G=function(t){function e(t,n){w(this,e);var i=C(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));i.__color=new M(i.getValue()),i.__temp=new M(0);var o=i;i.domElement=document.createElement("div"),F.makeSelectable(i.domElement,!1),i.__selector=document.createElement("div"),i.__selector.className="selector",i.__saturation_field=document.createElement("div"),i.__saturation_field.className="saturation-field",i.__field_knob=document.createElement("div"),i.__field_knob.className="field-knob",i.__field_knob_border="2px solid ",i.__hue_knob=document.createElement("div"),i.__hue_knob.className="hue-knob",i.__hue_field=document.createElement("div"),i.__hue_field.className="hue-field",i.__input=document.createElement("input"),i.__input.type="text",i.__input_textShadow="0 1px 1px ",F.bind(i.__input,"keydown",(function(t){13===t.keyCode&&c.call(this)})),F.bind(i.__input,"blur",c),F.bind(i.__selector,"mousedown",(function(){F.addClass(this,"drag").bind(window,"mouseup",(function(){F.removeClass(o.__selector,"drag")}))})),F.bind(i.__selector,"touchstart",(function(){F.addClass(this,"drag").bind(window,"touchend",(function(){F.removeClass(o.__selector,"drag")}))}));var r,s=document.createElement("div");function a(t){f(t),F.bind(window,"mousemove",f),F.bind(window,"touchmove",f),F.bind(window,"mouseup",u),F.bind(window,"touchend",u)}function l(t){m(t),F.bind(window,"mousemove",m),F.bind(window,"touchmove",m),F.bind(window,"mouseup",h),F.bind(window,"touchend",h)}function u(){F.unbind(window,"mousemove",f),F.unbind(window,"touchmove",f),F.unbind(window,"mouseup",u),F.unbind(window,"touchend",u),d()}function h(){F.unbind(window,"mousemove",m),F.unbind(window,"touchmove",m),F.unbind(window,"mouseup",h),F.unbind(window,"touchend",h),d()}function c(){var t=_(this.value);!1!==t?(o.__color.__state=t,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function d(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function f(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=o.__saturation_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,i=n.clientX,r=n.clientY,s=(i-e.left)/(e.right-e.left),a=1-(r-e.top)/(e.bottom-e.top);return a>1?a=1:a<0&&(a=0),s>1?s=1:s<0&&(s=0),o.__color.v=a,o.__color.s=s,o.setValue(o.__color.toOriginal()),!1}function m(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=o.__hue_field.getBoundingClientRect(),n=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return n>1?n=1:n<0&&(n=0),o.__color.h=360*n,o.setValue(o.__color.toOriginal()),!1}return p.extend(i.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),p.extend(i.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:i.__field_knob_border+(i.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),p.extend(i.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),p.extend(i.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),p.extend(s.style,{width:"100%",height:"100%",background:"none"}),W(s,"top","rgba(0,0,0,0)","#000"),p.extend(i.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(r=i.__hue_field).style.background="",r.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",r.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",p.extend(i.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:i.__input_textShadow+"rgba(0,0,0,0.7)"}),F.bind(i.__saturation_field,"mousedown",a),F.bind(i.__saturation_field,"touchstart",a),F.bind(i.__field_knob,"mousedown",a),F.bind(i.__field_knob,"touchstart",a),F.bind(i.__hue_field,"mousedown",l),F.bind(i.__hue_field,"touchstart",l),i.__saturation_field.appendChild(s),i.__selector.appendChild(i.__field_knob),i.__selector.appendChild(i.__saturation_field),i.__selector.appendChild(i.__hue_field),i.__hue_field.appendChild(i.__hue_knob),i.domElement.appendChild(i.__input),i.domElement.appendChild(i.__selector),i.updateDisplay(),i}return S(e,t),A(e,[{key:"updateDisplay",value:function(){var t=_(this.getValue());if(!1!==t){var e=!1;p.each(M.COMPONENTS,(function(n){if(!p.isUndefined(t[n])&&!p.isUndefined(this.__color.__state[n])&&t[n]!==this.__color.__state[n])return e=!0,{}}),this),e&&p.extend(this.__color.__state,t)}p.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,i=255-n;p.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,W(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),p.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}}]),e}(P),X=["-moz-","-o-","-webkit-","-ms-",""];function W(t,e,n,i){t.style.background="",p.each(X,(function(o){t.style.cssText+="background: "+o+"linear-gradient("+e+", "+n+" 0%, "+i+" 100%); "}))}var Y=function(t,e){var n=e||document,i=document.createElement("style");i.type="text/css",i.innerHTML=t;var o=n.getElementsByTagName("head")[0];try{o.appendChild(i)}catch(t){}},K='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',Q=function(t,e){var n=t[e];return p.isArray(arguments[2])||p.isObject(arguments[2])?new B(t,e,arguments[2]):p.isNumber(n)?p.isNumber(arguments[2])&&p.isNumber(arguments[3])?p.isNumber(arguments[4])?new I(t,e,arguments[2],arguments[3],arguments[4]):new I(t,e,arguments[2],arguments[3]):p.isNumber(arguments[4])?new j(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new j(t,e,{min:arguments[2],max:arguments[3]}):p.isString(n)?new N(t,e):p.isFunction(n)?new q(t,e,""):p.isBoolean(n)?new R(t,e):null};var J=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},Z=function(){function t(){w(this,t),this.backgroundElement=document.createElement("div"),p.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),F.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),p.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;F.bind(this.backgroundElement,"click",(function(){e.hide()}))}return A(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),p.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",F.unbind(t.domElement,"webkitTransitionEnd",e),F.unbind(t.domElement,"transitionend",e),F.unbind(t.domElement,"oTransitionEnd",e)};F.bind(this.domElement,"webkitTransitionEnd",e),F.bind(this.domElement,"transitionend",e),F.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-F.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-F.getHeight(this.domElement)/2+"px"}}]),t}();Y(function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var $=function(){try{return!!window.localStorage}catch(t){return!1}}(),tt=void 0,et=!0,nt=void 0,it=!1,ot=[],rt=function t(e){var n=this,i=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),F.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=p.defaults(i,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),i=p.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),p.isUndefined(i.load)?i.load={preset:"Default"}:i.preset&&(i.load.preset=i.preset),p.isUndefined(i.parent)&&i.hideable&&ot.push(this),i.resizable=p.isUndefined(i.parent)&&i.resizable,i.autoPlace&&p.isUndefined(i.scrollable)&&(i.scrollable=!0);var o,r=$&&"true"===localStorage.getItem(ct(this,"isLocal")),s=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:i.load.preset},set:function(t){n.parent?n.getRoot().preset=t:i.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),n.revert()}},width:{get:function(){return i.width},set:function(t){i.width=t,yt(n,t)}},name:{get:function(){return i.name},set:function(t){i.name=t,a&&(a.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(e){i.closed=e,i.closed?F.addClass(n.__ul,t.CLASS_CLOSED):F.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return r},set:function(t){$&&(r=t,t?F.bind(window,"unload",s):F.unbind(window,"unload",s),localStorage.setItem(ct(n,"isLocal"),t))}}}),p.isUndefined(i.parent)){if(this.closed=i.closed||!1,F.addClass(this.domElement,t.CLASS_MAIN),F.makeSelectable(this.domElement,!1),$&&r){n.useLocalStorage=!0;var l=localStorage.getItem(ct(this,"gui"));l&&(i.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,F.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),i.closeOnTop?(F.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(F.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),F.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===i.closed&&(i.closed=!0);var u=document.createTextNode(i.name);F.addClass(u,"controller-name"),a=st(n,u);F.addClass(this.__ul,t.CLASS_CLOSED),F.addClass(a,"title"),F.bind(a,"click",(function(t){return t.preventDefault(),n.closed=!n.closed,!1})),i.closed||(this.closed=!1)}i.autoPlace&&(p.isUndefined(i.parent)&&(et&&(nt=document.createElement("div"),F.addClass(nt,"dg"),F.addClass(nt,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(nt),et=!1),nt.appendChild(this.domElement),F.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||yt(n,i.width)),this.__resizeHandler=function(){n.onResizeDebounced()},F.bind(window,"resize",this.__resizeHandler),F.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),F.bind(this.__ul,"transitionend",this.__resizeHandler),F.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&pt(this),s=function(){$&&"true"===localStorage.getItem(ct(n,"isLocal"))&&localStorage.setItem(ct(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=s,i.parent||((o=n.getRoot()).width+=1,p.defer((function(){o.width-=1})))};function st(t,e,n){var i=document.createElement("li");return e&&i.appendChild(e),n?t.__ul.insertBefore(i,n):t.__ul.appendChild(i),t.onResize(),i}function at(t){F.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&F.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function lt(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];n.innerHTML=e?n.value+"*":n.value}function ut(t,e){var n=t.getRoot(),i=n.__rememberedObjects.indexOf(e.object);if(-1!==i){var o=n.__rememberedObjectIndecesToControllers[i];if(void 0===o&&(o={},n.__rememberedObjectIndecesToControllers[i]=o),o[e.property]=e,n.load&&n.load.remembered){var r=n.load.remembered,s=void 0;if(r[t.preset])s=r[t.preset];else{if(!r.Default)return;s=r.Default}if(s[i]&&void 0!==s[i][e.property]){var a=s[i][e.property];e.initialValue=a,e.setValue(a)}}}}function ht(t,e,n,i){if(void 0===e[n])throw new Error('Object "'+e+'" has no property "'+n+'"');var o=void 0;if(i.color)o=new G(e,n);else{var r=[e,n].concat(i.factoryArgs);o=Q.apply(t,r)}i.before instanceof P&&(i.before=i.before.__li),ut(t,o),F.addClass(o.domElement,"c");var s=document.createElement("span");F.addClass(s,"property-name"),s.innerHTML=o.property;var a=document.createElement("div");a.appendChild(s),a.appendChild(o.domElement);var l=st(t,a,i.before);return F.addClass(l,rt.CLASS_CONTROLLER_ROW),o instanceof G?F.addClass(l,"color"):F.addClass(l,k(o.getValue())),function(t,e,n){if(n.__li=e,n.__gui=t,p.extend(n,{options:function(e){if(arguments.length>1){var i=n.__li.nextElementSibling;return n.remove(),ht(t,n.object,n.property,{before:i,factoryArgs:[p.toArray(arguments)]})}if(p.isArray(e)||p.isObject(e)){var o=n.__li.nextElementSibling;return n.remove(),ht(t,n.object,n.property,{before:o,factoryArgs:[e]})}},name:function(t){return n.__li.firstElementChild.firstElementChild.innerHTML=t,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof I){var i=new j(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});p.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=n[t],o=i[t];n[t]=i[t]=function(){var t=Array.prototype.slice.call(arguments);return o.apply(i,t),e.apply(n,t)}})),F.addClass(e,"has-slider"),n.domElement.insertBefore(i.domElement,n.domElement.firstElementChild)}else if(n instanceof j){var o=function(e){if(p.isNumber(n.__min)&&p.isNumber(n.__max)){var i=n.__li.firstElementChild.firstElementChild.innerHTML,o=n.__gui.__listening.indexOf(n)>-1;n.remove();var r=ht(t,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return r.name(i),o&&r.listen(),r}return e};n.min=p.compose(o,n.min),n.max=p.compose(o,n.max)}else n instanceof R?(F.bind(e,"click",(function(){F.fakeEvent(n.__checkbox,"click")})),F.bind(n.__checkbox,"click",(function(t){t.stopPropagation()}))):n instanceof q?(F.bind(e,"click",(function(){F.fakeEvent(n.__button,"click")})),F.bind(e,"mouseover",(function(){F.addClass(n.__button,"hover")})),F.bind(e,"mouseout",(function(){F.removeClass(n.__button,"hover")}))):n instanceof G&&(F.addClass(e,"color"),n.updateDisplay=p.compose((function(t){return e.style.borderLeftColor=n.__color.toString(),t}),n.updateDisplay),n.updateDisplay());n.setValue=p.compose((function(e){return t.getRoot().__preset_select&&n.isModified()&&lt(t.getRoot(),!0),e}),n.setValue)}(t,l,o),t.__controllers.push(o),o}function ct(t,e){return document.location.href+"."+e}function dt(t,e,n){var i=document.createElement("option");i.innerHTML=e,i.value=e,t.__preset_select.appendChild(i),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function ft(t,e){e.style.display=t.useLocalStorage?"block":"none"}function mt(t){var e=t.__save_row=document.createElement("li");F.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),F.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",F.addClass(n,"button gears");var i=document.createElement("span");i.innerHTML="Save",F.addClass(i,"button"),F.addClass(i,"save");var o=document.createElement("span");o.innerHTML="New",F.addClass(o,"button"),F.addClass(o,"save-as");var r=document.createElement("span");r.innerHTML="Revert",F.addClass(r,"button"),F.addClass(r,"revert");var s=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?p.each(t.load.remembered,(function(e,n){dt(t,n,n===t.preset)})):dt(t,"Default",!1),F.bind(s,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(s),e.appendChild(n),e.appendChild(i),e.appendChild(o),e.appendChild(r),$){var a=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(ct(0,"isLocal"))&&l.setAttribute("checked","checked"),ft(t,a),F.bind(l,"change",(function(){t.useLocalStorage=!t.useLocalStorage,ft(t,a)}))}var u=document.getElementById("dg-new-constructor");F.bind(u,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||tt.hide()})),F.bind(n,"click",(function(){u.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),tt.show(),u.focus(),u.select()})),F.bind(i,"click",(function(){t.save()})),F.bind(o,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),F.bind(r,"click",(function(){t.revert()}))}function pt(t){var e=void 0;function n(n){return n.preventDefault(),t.width+=e-n.clientX,t.onResize(),e=n.clientX,!1}function i(){F.removeClass(t.__closeButton,rt.CLASS_DRAG),F.unbind(window,"mousemove",n),F.unbind(window,"mouseup",i)}function o(o){return o.preventDefault(),e=o.clientX,F.addClass(t.__closeButton,rt.CLASS_DRAG),F.bind(window,"mousemove",n),F.bind(window,"mouseup",i),!1}t.__resize_handle=document.createElement("div"),p.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),F.bind(t.__resize_handle,"mousedown",o),F.bind(t.__closeButton,"mousedown",o),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function yt(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function vt(t,e){var n={};return p.each(t.__rememberedObjects,(function(i,o){var r={},s=t.__rememberedObjectIndecesToControllers[o];p.each(s,(function(t,n){r[n]=e?t.initialValue:t.getValue()})),n[o]=r})),n}rt.toggleHide=function(){it=!it,p.each(ot,(function(t){t.domElement.style.display=it?"none":""}))},rt.CLASS_AUTO_PLACE="a",rt.CLASS_AUTO_PLACE_CONTAINER="ac",rt.CLASS_MAIN="main",rt.CLASS_CONTROLLER_ROW="cr",rt.CLASS_TOO_TALL="taller-than-window",rt.CLASS_CLOSED="closed",rt.CLASS_CLOSE_BUTTON="close-button",rt.CLASS_CLOSE_TOP="close-top",rt.CLASS_CLOSE_BOTTOM="close-bottom",rt.CLASS_DRAG="drag",rt.DEFAULT_WIDTH=245,rt.TEXT_CLOSED="Close Controls",rt.TEXT_OPEN="Open Controls",rt._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||rt.toggleHide()},F.bind(window,"keydown",rt._keydownHandler,!1),p.extend(rt.prototype,{add:function(t,e){return ht(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return ht(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;p.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&nt.removeChild(this.domElement);var t=this;p.each(this.__folders,(function(e){t.removeFolder(e)})),F.unbind(window,"keydown",rt._keydownHandler,!1),at(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var n=new rt(e);this.__folders[t]=n;var i=st(this,n.domElement);return F.addClass(i,"folder"),n},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],at(t);var e=this;p.each(t.__folders,(function(e){t.removeFolder(e)})),p.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=F.getOffset(t.__ul).top,n=0;p.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(n+=F.getHeight(e))})),window.innerHeight-e-20<n?(F.addClass(t.domElement,rt.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(F.removeClass(t.domElement,rt.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&p.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:p.debounce((function(){this.onResize()}),50),remember:function(){if(p.isUndefined(tt)&&((tt=new Z).domElement.innerHTML=K),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;p.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&mt(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&yt(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=vt(this)),t.folders={},p.each(this.__folders,(function(e,n){t.folders[n]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=vt(this),lt(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=vt(this,!0)),this.load.remembered[t]=vt(this),this.preset=t,dt(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){p.each(this.__controllers,(function(e){this.getRoot().load.remembered?ut(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),p.each(this.__folders,(function(t){t.revert(t)})),t||lt(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&function t(e){0!==e.length&&J.call(window,(function(){t(e)}));p.each(e,(function(t){t.updateDisplay()}))}(this.__listening)},updateDisplay:function(){p.each(this.__controllers,(function(t){t.updateDisplay()})),p.each(this.__folders,(function(t){t.updateDisplay()}))}});var gt=rt,_t=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"demo";n(this,e),this.id=i,this.renderer=null,this.loadingManager=new t.LoadingManager,this.assets=new Map,this.scene=new t.Scene,this.camera=null,this.controls=null,this.ready=!1}return o(e,[{key:"setRenderer",value:function(t){return this.renderer=t,this}},{key:"load",value:function(){return Promise.resolve()}},{key:"initialize",value:function(){}},{key:"render",value:function(t){this.renderer.render(this.scene,this.camera)}},{key:"registerOptions",value:function(t){}},{key:"reset",value:function(){return this.scene=new t.Scene,this.camera=null,null!==this.controls&&(this.controls.dispose(),this.controls=null),this.ready=!1,this}}]),e}(),bt=function(t){function e(t){var i;return n(this,e),(i=l(this,s(e).call(this,t))).previousDemo=null,i.demo=null,i}return r(e,t),e}((function t(e){n(this,t),this.type=e,this.target=null})),xt=new bt("change"),kt=new bt("load"),wt=function(e){function i(e){var o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.aside,u=void 0===a?e:a,h=r.renderer;return n(this,i),(o=l(this,s(i).call(this))).renderer=void 0!==h?h:function(){var n=new t.WebGLRenderer;return n.setSize(e.clientWidth,e.clientHeight),n.setPixelRatio(window.devicePixelRatio),n}(),e.appendChild(o.renderer.domElement),o.clock=new t.Clock,o.menu=new gt({autoPlace:!1}),u.appendChild(o.menu.domElement),o.demos=new Map,o.demo=null,o.currentDemo=null,o}return r(i,e),o(i,[{key:"resetMenu",value:function(){var t=this,e=this.menu.domElement.parentNode,n=new gt({autoPlace:!1});this.demos.size>1&&n.add(this,"demo",Array.from(this.demos.keys())).onChange((function(){return t.loadDemo()}));return e.removeChild(this.menu.domElement),e.appendChild(n.domElement),this.menu.destroy(),this.menu=n,n}},{key:"startDemo",value:function(t){t.id===this.demo&&(t.initialize(),t.registerOptions(this.resetMenu()),t.ready=!0,kt.demo=t,this.dispatchEvent(kt))}},{key:"loadDemo",value:function(){var t=this,e=this.demos.get(this.demo),n=this.currentDemo,i=this.renderer;window.location.hash=e.id,null!==n&&n.reset(),this.menu.domElement.style.display="none",xt.previousDemo=n,xt.demo=e,this.currentDemo=e,this.dispatchEvent(xt),i.clear(),e.load().then((function(){return t.startDemo(e)})).catch(console.error)}},{key:"addDemo",value:function(t){var e=window.location.hash.slice(1),n=this.currentDemo;return this.demos.set(t.id,t.setRenderer(this.renderer)),(null===this.demo&&0===e.length||t.id===e)&&(this.demo=t.id,this.loadDemo()),this.resetMenu(),null!==n&&n.ready&&n.registerOptions(this.menu),this}},{key:"removeDemo",value:function(t){var e,n=this.demos;return n.has(t)&&(n.delete(t),this.demo===t&&n.size>0?(e=n.entries().next().value,this.demo=e[0],this.currentDemo=e[1],this.loadDemo()):(this.demo=null,this.currentDemo=null,this.renderer.clear())),this}},{key:"setSize",value:function(e,n,i){var o=this.currentDemo;if(this.renderer.setSize(e,n,i),null!==o&&null!==o.camera){var r=o.camera;r instanceof t.OrthographicCamera?(r.left=e/-2,r.right=e/2,r.top=n/2,r.bottom=n/-2,r.updateProjectionMatrix()):r instanceof t.CubeCamera||(r.aspect=e/n,r.updateProjectionMatrix())}}},{key:"render",value:function(t){var e=this.currentDemo,n=this.clock.getDelta();null!==e&&e.ready&&e.render(n)}}]),i}(c),At=0,Et=1,St=2,Ct=3,Mt=4,zt=5,Ot=6,Pt=7,Tt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n(this,t),this.x=e,this.y=i,this.z=o}return o(t,[{key:"set",value:function(t,e,n){return this.x=t,this.y=e,this.z=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}},{key:"setFromSpherical",value:function(t){this.setFromSphericalCoords(t.radius,t.phi,t.theta)}},{key:"setFromSphericalCoords",value:function(t,e,n){var i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}},{key:"setFromCylindrical",value:function(t){this.setFromCylindricalCoords(t.radius,t.theta,t.y)}},{key:"setFromCylindricalCoords",value:function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}},{key:"setFromMatrixColumn",value:function(t,e){return this.fromArray(t.elements,4*e)}},{key:"setFromMatrixPosition",value:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}},{key:"setFromMatrixScale",value:function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this.z/=t,this}},{key:"crossVectors",value:function(t,e){var n=t.x,i=t.y,o=t.z,r=e.x,s=e.y,a=e.z;return this.x=i*a-o*s,this.y=o*r-n*a,this.z=n*s-i*r,this}},{key:"cross",value:function(t){return this.crossVectors(this,t)}},{key:"transformDirection",value:function(t){var e=this.x,n=this.y,i=this.z,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*i,this.y=o[1]*e+o[5]*n+o[9]*i,this.z=o[2]*e+o[6]*n+o[10]*i,this.normalize()}},{key:"applyMatrix3",value:function(t){var e=this.x,n=this.y,i=this.z,o=t.elements;return this.x=o[0]*e+o[3]*n+o[6]*i,this.y=o[1]*e+o[4]*n+o[7]*i,this.z=o[2]*e+o[5]*n+o[8]*i,this}},{key:"applyMatrix4",value:function(t){var e=this.x,n=this.y,i=this.z,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*i+o[12],this.y=o[1]*e+o[5]*n+o[9]*i+o[13],this.z=o[2]*e+o[6]*n+o[10]*i+o[14],this}},{key:"applyQuaternion",value:function(t){var e=this.x,n=this.y,i=this.z,o=t.x,r=t.y,s=t.z,a=t.w,l=a*e+r*i-s*n,u=a*n+s*e-o*i,h=a*i+o*n-r*e,c=-o*e-r*n-s*i;return this.x=l*a+c*-o+u*-s-h*-r,this.y=u*a+c*-r+h*-o-l*-s,this.z=h*a+c*-s+l*-r-u*-o,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"reflect",value:function(t){var e=t.x,n=t.y,i=t.z;return this.sub(t.multiplyScalar(2*this.dot(t))),t.set(e,n,i),this}},{key:"angleTo",value:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSquared()*t.lengthSquared());return Math.acos(Math.min(Math.max(e,-1),1))}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}},{key:"lerpVectors",value:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}}]),t}(),Lt=new Tt,Dt=[new Tt,new Tt,new Tt,new Tt,new Tt,new Tt,new Tt,new Tt],Ft=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Tt(1/0,1/0,1/0),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tt(-1/0,-1/0,-1/0);n(this,t),this.min=e,this.max=i}return o(t,[{key:"set",value:function(t,e){return this.min.copy(t),this.max.copy(e),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Tt;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Tt;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"setFromSphere",value:function(t){return this.set(t.center,t.center),this.expandByScalar(t.radius),this}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"setFromPoints",value:function(t){var e,n;for(this.min.set(0,0,0),this.max.set(0,0,0),e=0,n=t.length;e<n;++e)this.expandByPoint(t[e]);return this}},{key:"setFromCenterAndSize",value:function(t,e){var n=Lt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}},{key:"clampPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tt;return e.copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return Lt.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"applyMatrix4",value:function(t){var e=this.min,n=this.max;return this.isEmpty()||(Dt[0].set(e.x,e.y,e.z).applyMatrix4(t),Dt[1].set(e.x,e.y,n.z).applyMatrix4(t),Dt[2].set(e.x,n.y,e.z).applyMatrix4(t),Dt[3].set(e.x,n.y,n.z).applyMatrix4(t),Dt[4].set(n.x,e.y,e.z).applyMatrix4(t),Dt[5].set(n.x,e.y,n.z).applyMatrix4(t),Dt[6].set(n.x,n.y,e.z).applyMatrix4(t),Dt[7].set(n.x,n.y,n.z).applyMatrix4(t),this.setFromPoints(Dt)),this}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"containsPoint",value:function(t){var e=this.min,n=this.max;return t.x>=e.x&&t.y>=e.y&&t.z>=e.z&&t.x<=n.x&&t.y<=n.y&&t.z<=n.z}},{key:"containsBox",value:function(t){var e=this.min,n=this.max,i=t.min,o=t.max;return e.x<=i.x&&o.x<=n.x&&e.y<=i.y&&o.y<=n.y&&e.z<=i.z&&o.z<=n.z}},{key:"intersectsBox",value:function(t){var e=this.min,n=this.max,i=t.min,o=t.max;return o.x>=e.x&&o.y>=e.y&&o.z>=e.z&&i.x<=n.x&&i.y<=n.y&&i.z<=n.z}},{key:"intersectsSphere",value:function(t){return this.clampPoint(t.center,Lt).distanceToSquared(t.center)<=t.radius*t.radius}},{key:"intersectsPlane",value:function(t){var e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}]),t}(),Rt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n(this,t),this.x=e,this.y=i}return o(t,[{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this}},{key:"applyMatrix3",value:function(t){var e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}},{key:"lerpVectors",value:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)}},{key:"rotateAround",value:function(t,e){var n=Math.cos(e),i=Math.sin(e),o=this.x-t.x,r=this.y-t.y;return this.x=o*n-r*i+t.x,this.y=o*i+r*n+t.y,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y}},{key:"width",get:function(){return this.x},set:function(t){return this.x=t}},{key:"height",get:function(){return this.y},set:function(t){return this.y=t}}]),t}(),Bt="XYZ",Nt="YZX",Ht="ZXY",Vt="XZY",jt="YXZ",Ut="ZYX",It=new Tt,qt=new Tt,Gt=new Tt,Xt=function(){function t(){n(this,t),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return o(t,[{key:"set",value:function(t,e,n,i,o,r,s,a,l,u,h,c,d,f,m,p){var y=this.elements;return y[0]=t,y[4]=e,y[8]=n,y[12]=i,y[1]=o,y[5]=r,y[9]=s,y[13]=a,y[2]=l,y[6]=u,y[10]=h,y[14]=c,y[3]=d,y[7]=f,y[11]=m,y[15]=p,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"copy",value:function(t){var e=t.elements,n=this.elements;return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements;for(e=0;e<16;++e)i[e]=t[e+n];return this}},{key:"toArray",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements;for(t=0;t<16;++t)e[t+n]=i[t];return e}},{key:"getMaxScaleOnAxis",value:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}},{key:"copyPosition",value:function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}},{key:"setPosition",value:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this}},{key:"extractBasis",value:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(t){var e=this.elements,n=t.elements,i=1/It.setFromMatrixColumn(t,0).length(),o=1/It.setFromMatrixColumn(t,1).length(),r=1/It.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*o,e[5]=n[5]*o,e[6]=n[6]*o,e[7]=0,e[8]=n[8]*r,e[9]=n[9]*r,e[10]=n[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"makeRotationFromEuler",value:function(t){var e,n,i,o,r,s,a,l,u,h,c,d,f=this.elements,m=t.x,p=t.y,y=t.z,v=Math.cos(m),g=Math.sin(m),_=Math.cos(p),b=Math.sin(p),x=Math.cos(y),k=Math.sin(y);switch(t.order){case Bt:e=v*x,n=v*k,i=g*x,o=g*k,f[0]=_*x,f[4]=-_*k,f[8]=b,f[1]=n+i*b,f[5]=e-o*b,f[9]=-g*_,f[2]=o-e*b,f[6]=i+n*b,f[10]=v*_;break;case jt:r=_*x,s=_*k,a=b*x,l=b*k,f[0]=r+l*g,f[4]=a*g-s,f[8]=v*b,f[1]=v*k,f[5]=v*x,f[9]=-g,f[2]=s*g-a,f[6]=l+r*g,f[10]=v*_;break;case Ht:r=_*x,s=_*k,a=b*x,l=b*k,f[0]=r-l*g,f[4]=-v*k,f[8]=a+s*g,f[1]=s+a*g,f[5]=v*x,f[9]=l-r*g,f[2]=-v*b,f[6]=g,f[10]=v*_;break;case Ut:e=v*x,n=v*k,i=g*x,o=g*k,f[0]=_*x,f[4]=i*b-n,f[8]=e*b+o,f[1]=_*k,f[5]=o*b+e,f[9]=n*b-i,f[2]=-b,f[6]=g*_,f[10]=v*_;break;case Nt:u=v*_,h=v*b,c=g*_,d=g*b,f[0]=_*x,f[4]=d-u*k,f[8]=c*k+h,f[1]=k,f[5]=v*x,f[9]=-g*x,f[2]=-b*x,f[6]=h*k+c,f[10]=u-d*k;break;case Vt:u=v*_,h=v*b,c=g*_,d=g*b,f[0]=_*x,f[4]=-k,f[8]=b*x,f[1]=u*k+d,f[5]=v*x,f[9]=h*k-c,f[2]=c*k-h,f[6]=g*x,f[10]=d*k+u}return f[3]=0,f[7]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(t){return this.compose(It.set(0,0,0),t,qt.set(1,1,1))}},{key:"lookAt",value:function(t,e,n){var i=this.elements,o=It,r=qt,s=Gt;return s.subVectors(t,e),0===s.lengthSquared()&&(s.z=1),s.normalize(),o.crossVectors(n,s),0===o.lengthSquared()&&(1===Math.abs(n.z)?s.x+=1e-4:s.z+=1e-4,s.normalize(),o.crossVectors(n,s)),o.normalize(),r.crossVectors(s,o),i[0]=o.x,i[4]=r.x,i[8]=s.x,i[1]=o.y,i[5]=r.y,i[9]=s.y,i[2]=o.z,i[6]=r.z,i[10]=s.z,this}},{key:"multiplyMatrices",value:function(t,e){var n=this.elements,i=t.elements,o=e.elements,r=i[0],s=i[4],a=i[8],l=i[12],u=i[1],h=i[5],c=i[9],d=i[13],f=i[2],m=i[6],p=i[10],y=i[14],v=i[3],g=i[7],_=i[11],b=i[15],x=o[0],k=o[4],w=o[8],A=o[12],E=o[1],S=o[5],C=o[9],M=o[13],z=o[2],O=o[6],P=o[10],T=o[14],L=o[3],D=o[7],F=o[11],R=o[15];return n[0]=r*x+s*E+a*z+l*L,n[4]=r*k+s*S+a*O+l*D,n[8]=r*w+s*C+a*P+l*F,n[12]=r*A+s*M+a*T+l*R,n[1]=u*x+h*E+c*z+d*L,n[5]=u*k+h*S+c*O+d*D,n[9]=u*w+h*C+c*P+d*F,n[13]=u*A+h*M+c*T+d*R,n[2]=f*x+m*E+p*z+y*L,n[6]=f*k+m*S+p*O+y*D,n[10]=f*w+m*C+p*P+y*F,n[14]=f*A+m*M+p*T+y*R,n[3]=v*x+g*E+_*z+b*L,n[7]=v*k+g*S+_*O+b*D,n[11]=v*w+g*C+_*P+b*F,n[15]=v*A+g*M+_*T+b*R,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyScalar",value:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],n=t[4],i=t[8],o=t[12],r=t[1],s=t[5],a=t[9],l=t[13],u=t[2],h=t[6],c=t[10],d=t[14],f=e*s,m=e*a,p=e*l,y=n*r,v=n*a,g=n*l,_=i*r,b=i*s,x=i*l,k=o*r,w=o*s,A=o*a;return t[3]*(A*h-x*h-w*c+g*c+b*d-v*d)+t[7]*(m*d-p*c+k*c-_*d+x*u-A*u)+t[11]*(p*h-f*d-k*h+y*d+w*u-g*u)+t[15]*(-b*u-m*h+f*c+_*h-y*c+v*u)}},{key:"getInverse",value:function(t){var e,n=this.elements,i=t.elements,o=i[0],r=i[1],s=i[2],a=i[3],l=i[4],u=i[5],h=i[6],c=i[7],d=i[8],f=i[9],m=i[10],p=i[11],y=i[12],v=i[13],g=i[14],_=i[15],b=f*g*c-v*m*c+v*h*p-u*g*p-f*h*_+u*m*_,x=y*m*c-d*g*c-y*h*p+l*g*p+d*h*_-l*m*_,k=d*v*c-y*f*c+y*u*p-l*v*p-d*u*_+l*f*_,w=y*f*h-d*v*h-y*u*m+l*v*m+d*u*g-l*f*g,A=o*b+r*x+s*k+a*w;return 0!==A?(e=1/A,n[0]=b*e,n[1]=(v*m*a-f*g*a-v*s*p+r*g*p+f*s*_-r*m*_)*e,n[2]=(u*g*a-v*h*a+v*s*c-r*g*c-u*s*_+r*h*_)*e,n[3]=(f*h*a-u*m*a-f*s*c+r*m*c+u*s*p-r*h*p)*e,n[4]=x*e,n[5]=(d*g*a-y*m*a+y*s*p-o*g*p-d*s*_+o*m*_)*e,n[6]=(y*h*a-l*g*a-y*s*c+o*g*c+l*s*_-o*h*_)*e,n[7]=(l*m*a-d*h*a+d*s*c-o*m*c-l*s*p+o*h*p)*e,n[8]=k*e,n[9]=(y*f*a-d*v*a-y*r*p+o*v*p+d*r*_-o*f*_)*e,n[10]=(l*v*a-y*u*a+y*r*c-o*v*c-l*r*_+o*u*_)*e,n[11]=(d*u*a-l*f*a-d*r*c+o*f*c+l*r*p-o*u*p)*e,n[12]=w*e,n[13]=(d*v*s-y*f*s+y*r*m-o*v*m-d*r*g+o*f*g)*e,n[14]=(y*u*s-l*v*s-y*r*h+o*v*h+l*r*g-o*u*g)*e,n[15]=(l*f*s-d*u*s+d*r*h-o*f*h-l*r*m+o*u*m)*e):(console.error("Can't invert matrix, determinant is zero",t),this.identity()),this}},{key:"transpose",value:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}},{key:"scale",value:function(t,e,n){var i=this.elements;return i[0]*=t,i[4]*=e,i[8]*=n,i[1]*=t,i[5]*=e,i[9]*=n,i[2]*=t,i[6]*=e,i[10]*=n,i[3]*=t,i[7]*=e,i[11]*=n,this}},{key:"makeScale",value:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeTranslation",value:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}},{key:"makeRotationY",value:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(t,e){var n=Math.cos(e),i=Math.sin(e),o=1-n,r=t.x,s=t.y,a=t.z,l=o*r,u=o*s;return this.set(l*r+n,l*s-i*a,l*a+i*s,0,l*s+i*a,u*s+n,u*a-i*r,0,l*a-i*s,u*a+i*r,o*a*a+n,0,0,0,0,1),this}},{key:"makeShear",value:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this}},{key:"compose",value:function(t,e,n){var i=this.elements,o=e.x,r=e.y,s=e.z,a=e.w,l=o+o,u=r+r,h=s+s,c=o*l,d=o*u,f=o*h,m=r*u,p=r*h,y=s*h,v=a*l,g=a*u,_=a*h,b=n.x,x=n.y,k=n.z;return i[0]=(1-(m+y))*b,i[1]=(d+_)*b,i[2]=(f-g)*b,i[3]=0,i[4]=(d-_)*x,i[5]=(1-(c+y))*x,i[6]=(p+v)*x,i[7]=0,i[8]=(f+g)*k,i[9]=(p-v)*k,i[10]=(1-(c+m))*k,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}},{key:"decompose",value:function(t,e,n){var i=this.elements,o=i[0],r=i[1],s=i[2],a=i[4],l=i[5],u=i[6],h=i[8],c=i[9],d=i[10],f=this.determinant(),m=It.set(o,r,s).length()*(f<0?-1:1),p=It.set(a,l,u).length(),y=It.set(h,c,d).length(),v=1/m,g=1/p,_=1/y;return t.x=i[12],t.y=i[13],t.z=i[14],i[0]*=v,i[1]*=v,i[2]*=v,i[4]*=g,i[5]*=g,i[6]*=g,i[8]*=_,i[9]*=_,i[10]*=_,e.setFromRotationMatrix(this),i[0]=o,i[1]=r,i[2]=s,i[4]=a,i[5]=l,i[6]=u,i[8]=h,i[9]=c,i[10]=d,n.x=m,n.y=p,n.z=y,this}},{key:"makePerspective",value:function(t,e,n,i,o,r){var s=this.elements,a=2*o/(e-t),l=2*o/(n-i),u=(e+t)/(e-t),h=(n+i)/(n-i),c=-(r+o)/(r-o),d=-2*r*o/(r-o);return s[0]=a,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=l,s[9]=h,s[13]=0,s[2]=0,s[6]=0,s[10]=c,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}},{key:"makeOrthographic",value:function(t,e,n,i,o,r){var s=this.elements,a=1/(e-t),l=1/(n-i),u=1/(r-o),h=(e+t)*a,c=(n+i)*l,d=(r+o)*u;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-h,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-c,s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}},{key:"equals",value:function(t){var e,n=this.elements,i=t.elements,o=!0;for(e=0;o&&e<16;++e)n[e]!==i[e]&&(o=!1);return o}}]),t}(),Wt=[new Tt,new Tt,new Tt,new Tt],Yt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Tt,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tt;n(this,t),this.origin=e,this.direction=i}return o(t,[{key:"set",value:function(t,e){return this.origin.copy(t),this.direction.copy(e),this}},{key:"copy",value:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"at",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tt;return e.copy(this.direction).multiplyScalar(t).add(this.origin)}},{key:"lookAt",value:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this}},{key:"recast",value:function(t){return this.origin.copy(this.at(t,Wt[0])),this}},{key:"closestPointToPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tt,n=e.subVectors(t,this.origin).dot(this.direction);return n>=0?e.copy(this.direction).multiplyScalar(n).add(this.origin):e.copy(this.origin)}},{key:"distanceSquaredToPoint",value:function(t){var e=Wt[0].subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):Wt[0].copy(this.direction).multiplyScalar(e).add(this.origin).distanceToSquared(t)}},{key:"distanceToPoint",value:function(t){return Math.sqrt(this.distanceSquaredToPoint(t))}},{key:"distanceToPlane",value:function(t){var e=t.normal.dot(this.direction),n=0!==e?-(this.origin.dot(t.normal)+t.constant)/e:0===t.distanceToPoint(this.origin)?0:-1;return n>=0?n:null}},{key:"distanceSquaredToSegment",value:function(t,e,n,i){var o,r,s,a,l,u=Wt[0].copy(t).add(e).multiplyScalar(.5),h=Wt[1].copy(e).sub(t).normalize(),c=Wt[2].copy(this.origin).sub(u),d=.5*t.distanceTo(e),f=-this.direction.dot(h),m=c.dot(this.direction),p=-c.dot(h),y=c.lengthSq(),v=Math.abs(1-f*f);return v>0?(r=f*m-p,s=d*v,(o=f*p-m)>=0?r>=-s?r<=s?l=(o*=a=1/v)*(o+f*(r*=a)+2*m)+r*(f*o+r+2*p)+y:(r=d,l=-(o=Math.max(0,-(f*r+m)))*o+r*(r+2*p)+y):(r=-d,l=-(o=Math.max(0,-(f*r+m)))*o+r*(r+2*p)+y):r<=-s?l=-(o=Math.max(0,-(-f*d+m)))*o+(r=o>0?-d:Math.min(Math.max(-d,-p),d))*(r+2*p)+y:r<=s?(o=0,l=(r=Math.min(Math.max(-d,-p),d))*(r+2*p)+y):l=-(o=Math.max(0,-(f*d+m)))*o+(r=o>0?d:Math.min(Math.max(-d,-p),d))*(r+2*p)+y):(r=f>0?-d:d,l=-(o=Math.max(0,-(f*r+m)))*o+r*(r+2*p)+y),void 0!==n&&n.copy(this.direction).multiplyScalar(o).add(this.origin),void 0!==i&&i.copy(h).multiplyScalar(r).add(u),l}},{key:"intersectSphere",value:function(t){var e,n,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tt,r=Wt[0].subVectors(t.center,this.origin),s=r.dot(this.direction),a=r.dot(r)-s*s,l=t.radius*t.radius,u=null;return a<=l&&(i=s+(e=Math.sqrt(l-a)),((n=s-e)>=0||i>=0)&&(u=n<0?this.at(i,o):this.at(n,o))),u}},{key:"intersectsSphere",value:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}},{key:"intersectPlane",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tt,n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}},{key:"intersectsPlane",value:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}},{key:"intersectBox",value:function(t){var e,n,i,o,r,s,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tt,l=this.origin,u=this.direction,h=t.min,c=t.max,d=1/u.x,f=1/u.y,m=1/u.z,p=null;return d>=0?(e=(h.x-l.x)*d,n=(c.x-l.x)*d):(e=(c.x-l.x)*d,n=(h.x-l.x)*d),f>=0?(i=(h.y-l.y)*f,o=(c.y-l.y)*f):(i=(c.y-l.y)*f,o=(h.y-l.y)*f),e<=o&&i<=n&&((i>e||e!=e)&&(e=i),(o<n||n!=n)&&(n=o),m>=0?(r=(h.z-l.z)*m,s=(c.z-l.z)*m):(r=(c.z-l.z)*m,s=(h.z-l.z)*m),e<=s&&r<=n&&((r>e||e!=e)&&(e=r),(s<n||n!=n)&&(n=s),n>=0&&(p=this.at(e>=0?e:n,a)))),p}},{key:"intersectsBox",value:function(t){return null!==this.intersectBox(t,Wt[0])}},{key:"intersectTriangle",value:function(t,e,n,i,o){var r,s,a,l,u,h=this.direction,c=Wt[0],d=Wt[1],f=Wt[2],m=Wt[3],p=null;return d.subVectors(e,t),f.subVectors(n,t),m.crossVectors(d,f),0===(r=h.dot(m))||i&&r>0||(r>0?s=1:(s=-1,r=-r),c.subVectors(this.origin,t),(a=s*h.dot(f.crossVectors(c,f)))>=0&&(l=s*h.dot(d.cross(c)))>=0&&a+l<=r&&(u=-s*c.dot(m))>=0&&(p=this.at(u/r,o))),p}},{key:"applyMatrix4",value:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}},{key:"equals",value:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}]),t}(),Kt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n(this,t),this.radius=e,this.phi=i,this.theta=o}return o(t,[{key:"set",value:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeSafe",value:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}},{key:"setFromVector3",value:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}},{key:"setFromCartesianCoords",value:function(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Math.min(Math.max(e/this.radius,-1),1))),this}}]),t}(),Qt=0,Jt=1,Zt=2,$t=2*Math.PI,te=new Tt,ee=new Xt,ne=function(){function t(e,i,o,r){n(this,t),this.position=e,this.quaternion=i,this.target=o,this.settings=r,this.spherical=new Kt}return o(t,[{key:"setPosition",value:function(t){return this.position=t,this}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this}},{key:"setTarget",value:function(t){return this.target=t,this}},{key:"updateQuaternion",value:function(){var t=this.settings,e=t.rotation;return t.general.orbit?ee.lookAt(te.subVectors(this.position,this.target),e.pivotOffset,e.up):ee.lookAt(te.set(0,0,0),this.target.setFromSpherical(this.spherical),e.up),this.quaternion.setFromRotationMatrix(ee),this}},{key:"adjustSpherical",value:function(t,e){var n=this.settings,i=n.general.orbit,o=n.rotation,r=this.spherical;return r.theta=o.invertX?r.theta+t:r.theta-t,r.phi=!i&&!o.invertY||i&&o.invertY?r.phi+e:r.phi-e,r.theta=Math.min(Math.max(r.theta,o.minAzimuthalAngle),o.maxAzimuthalAngle),r.phi=Math.min(Math.max(r.phi,o.minPolarAngle),o.maxPolarAngle),r.theta%=$t,r.makeSafe(),i&&this.position.setFromSpherical(r).add(this.target),this}},{key:"zoom",value:function(t){var e,n,i,o=this.settings,r=o.general,s=o.sensitivity,a=o.zoom,l=this.spherical;return r.orbit&&a.enabled&&(e=t*s.zoom,a.invert&&(e=-e),n=Math.max(a.minDistance,1e-6),i=Math.min(a.maxDistance,1/0),l.radius=Math.min(Math.max(l.radius+e,n),i),this.position.setFromSpherical(l).add(this.target)),this}},{key:"update",value:function(t){}},{key:"lookAt",value:function(t){var e=this.spherical,n=this.position,i=this.target;return i.copy(t),this.settings.general.orbit?te.subVectors(n,i):te.subVectors(i,n).normalize(),e.setFromVector3(te),e.radius=Math.max(e.radius,1e-6),this.updateQuaternion(),this}},{key:"getViewDirection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Tt;return t.setFromSpherical(this.spherical).normalize(),this.settings.general.orbit&&t.negate(),t}}]),t}(),ie=function(){function t(){n(this,t),this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1}return o(t,[{key:"reset",value:function(){return this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1,this}}]),t}(),oe=new Tt(1,0,0),re=new Tt(0,1,0),se=new Tt(0,0,1),ae=new Tt,le=function(){function t(e,i,o,r){n(this,t),this.position=e,this.quaternion=i,this.target=o,this.settings=r,this.movementState=new ie}return o(t,[{key:"setPosition",value:function(t){return this.position=t,this}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this}},{key:"setTarget",value:function(t){return this.target=t,this}},{key:"translateOnAxis",value:function(t,e){ae.copy(t).applyQuaternion(this.quaternion).multiplyScalar(e),this.position.add(ae),this.settings.general.orbit&&this.target.add(ae)}},{key:"translate",value:function(t){var e=this.settings.sensitivity,n=this.movementState,i=t*e.translation;n.backward?this.translateOnAxis(se,i):n.forward&&this.translateOnAxis(se,-i),n.right?this.translateOnAxis(oe,i):n.left&&this.translateOnAxis(oe,-i),n.up?this.translateOnAxis(re,i):n.down&&this.translateOnAxis(re,-i)}},{key:"update",value:function(t){this.settings.translation.enabled&&this.translate(t)}},{key:"moveTo",value:function(t){return this.settings.general.orbit?this.target.copy(t):this.position.copy(t),this}}]),t}(),ue=new Proxy({BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,META_LEFT:91,META_RIGHT:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},{get:function(t,e){return e in t?t[e]:1===e.length?e.toUpperCase().charCodeAt(0):void 0}}),he=function(){function t(){n(this,t),this.orbit=!0}return o(t,[{key:"copy",value:function(t){return this.orbit=t.orbit,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),ce=function(){function t(){n(this,t),this.defaultActions=new Map,this.actions=new Map}return o(t,[{key:"reset",value:function(){return this.actions=new Map(this.defaultActions),this}},{key:"setDefault",value:function(t){return this.defaultActions=t,this.reset()}},{key:"copy",value:function(t){return this.defaultActions=new Map(t.defaultActions),this.actions=new Map(t.actions),this}},{key:"clearDefault",value:function(){return this.defaultActions.clear(),this}},{key:"clear",value:function(){return this.actions.clear(),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"has",value:function(t){return this.actions.has(t)}},{key:"get",value:function(t){return this.actions.get(t)}},{key:"set",value:function(t,e){return this.actions.set(t,e),this}},{key:"delete",value:function(t){return this.actions.delete(t)}},{key:"toJSON",value:function(){return{defaultActions:h(this.defaultActions),actions:h(this.actions)}}}]),t}(),de=function(){function t(){n(this,t),this.hold=!1,this.lock=!0}return o(t,[{key:"copy",value:function(t){return this.hold=t.hold,this.lock=t.lock,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),fe=function(){function t(){n(this,t),this.up=new Tt,this.up.copy(re),this.pivotOffset=new Tt,this.minAzimuthalAngle=-1/0,this.maxAzimuthalAngle=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.invertX=!1,this.invertY=!1}return o(t,[{key:"copy",value:function(t){return this.up.copy(t.up),this.pivotOffset.copy(t.pivotOffset),this.minAzimuthalAngle=null!==t.minAzimuthalAngle?t.minAzimuthalAngle:-1/0,this.maxAzimuthalAngle=null!==t.maxAzimuthalAngle?t.maxAzimuthalAngle:1/0,this.minPolarAngle=t.minPolarAngle,this.maxPolarAngle=t.maxPolarAngle,this.invertX=t.invertX,this.invertY=t.invertY,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),me=function(){function t(){n(this,t),this.rotation=.0025,this.translation=1,this.zoom=.1}return o(t,[{key:"copy",value:function(t){return this.rotation=t.rotation,this.translation=t.translation,this.zoom=t.zoom,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),pe=function(){function t(){n(this,t),this.enabled=!0}return o(t,[{key:"copy",value:function(t){return this.enabled=t.enabled,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),ye=function(){function t(){n(this,t),this.enabled=!0,this.invert=!1,this.minDistance=1e-6,this.maxDistance=1/0}return o(t,[{key:"copy",value:function(t){return this.enabled=t.enabled,this.invert=t.invert,this.minDistance=t.minDistance,this.maxDistance=t.maxDistance,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),ve=function(){function t(){n(this,t),this.general=new he,this.keyBindings=new ce,this.keyBindings.setDefault(new Map([[ue.W,At],[ue.UP,At],[ue.A,Et],[ue.LEFT,Et],[ue.S,St],[ue.DOWN,St],[ue.D,Ct],[ue.RIGHT,Ct],[ue.X,Mt],[ue.SPACE,zt],[ue.PAGE_DOWN,Ot],[ue.PAGE_UP,Pt]])),this.pointer=new de,this.rotation=new fe,this.sensitivity=new me,this.translation=new pe,this.zoom=new ye}return o(t,[{key:"copy",value:function(t){return this.general.copy(t.general),this.keyBindings.copy(t.keyBindings),this.pointer.copy(t.pointer),this.rotation.copy(t.rotation),this.sensitivity.copy(t.sensitivity),this.translation.copy(t.translation),this.zoom.copy(t.zoom),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toDataURL",value:function(){return URL.createObjectURL(new Blob([JSON.stringify(this)],{type:"text/json"}))}}]),t}(),ge=function(){function t(){n(this,t)}return o(t,[{key:"execute",value:function(t){throw new Error("Strategy#execute method not implemented!")}}]),t}(),_e=function(t){function e(t,i){var o;return n(this,e),(o=l(this,s(e).call(this))).movementState=t,o.direction=i,o}return r(e,t),o(e,[{key:"execute",value:function(t){var e=this.movementState;switch(this.direction){case be.FORWARD:e.forward=t;break;case be.LEFT:e.left=t;break;case be.BACKWARD:e.backward=t;break;case be.RIGHT:e.right=t;break;case be.DOWN:e.down=t;break;case be.UP:e.up=t}}}]),e}(ge),be={FORWARD:0,LEFT:1,BACKWARD:2,RIGHT:3,DOWN:4,UP:5},xe=function(t){function e(t,i){var o;return n(this,e),(o=l(this,s(e).call(this))).rotationManager=t,o.zoomIn=i,o}return r(e,t),o(e,[{key:"execute",value:function(t){t&&this.rotationManager.zoom(this.zoomIn?-1:1)}}]),e}(ge),ke=function(){function t(){var e,i,o,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document.body;n(this,t),this.dom=a,this.position=r,this.quaternion=s,this.target=new Tt,this.settings=new ve,this.rotationManager=new ne(r,s,this.target,this.settings),this.translationManager=new le(r,s,this.target,this.settings),this.strategies=(e=this.rotationManager,i=this.translationManager,o=i.movementState,new Map([[At,new _e(o,be.FORWARD)],[Et,new _e(o,be.LEFT)],[St,new _e(o,be.BACKWARD)],[Ct,new _e(o,be.RIGHT)],[Mt,new _e(o,be.DOWN)],[zt,new _e(o,be.UP)],[Ot,new xe(e,!1)],[Pt,new xe(e,!0)]])),this.lastScreenPosition=new Rt,this.dragging=!1,this.enabled=!1,null!==r&&null!==s&&(this.lookAt(this.target),null!==a&&this.setEnabled())}return o(t,[{key:"getDom",value:function(){return this.dom}},{key:"getPosition",value:function(){return this.position}},{key:"getQuaternion",value:function(){return this.quaternion}},{key:"getTarget",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Tt;return t.copy(this.target),this.settings.general.orbit||t.add(this.position),t}},{key:"getViewDirection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Tt;return this.rotationManager.getViewDirection(t)}},{key:"setDom",value:function(t){var e=this.enabled;return null!==t&&(e&&this.setEnabled(!1),this.dom=t,this.setEnabled(e)),this}},{key:"setPosition",value:function(t){return this.position=t,this.rotationManager.setPosition(t),this.translationManager.setPosition(t),this.lookAt(this.target)}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this.rotationManager.setQuaternion(t),this.translationManager.setQuaternion(t),this.lookAt(this.target)}},{key:"setTarget",value:function(t){return this.target=t,this.rotationManager.setTarget(t),this.translationManager.setTarget(t),this.lookAt(this.target)}},{key:"setOrbitEnabled",value:function(t){var e=this.settings.general;return e.orbit!==t&&(this.getTarget(this.target),e.orbit=t,this.lookAt(this.target)),this}},{key:"copy",value:function(t){return this.dom=t.getDom(),this.position=t.getPosition(),this.quaternion=t.getQuaternion(),this.target=t.getTarget(),this.settings.copy(t.settings),this.rotationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.translationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.lookAt(this.target)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"handlePointerMoveEvent",value:function(t){var e,n,i=this.settings,o=i.pointer,r=i.sensitivity,s=this.rotationManager,a=this.lastScreenPosition;document.pointerLockElement===this.dom?o.hold&&!this.dragging||s.adjustSpherical(t.movementX*r.rotation,t.movementY*r.rotation).updateQuaternion():(e=t.screenX-a.x,n=t.screenY-a.y,a.set(t.screenX,t.screenY),s.adjustSpherical(e*r.rotation,n*r.rotation).updateQuaternion())}},{key:"handleTouchMoveEvent",value:function(t){var e=this.settings.sensitivity,n=this.rotationManager,i=this.lastScreenPosition,o=t.touches[0],r=o.screenX-i.x,s=o.screenY-i.y;i.set(o.screenX,o.screenY),t.preventDefault(),n.adjustSpherical(r*e.rotation,s*e.rotation).updateQuaternion()}},{key:"handleMainPointerButton",value:function(t,e){this.dragging=e,this.settings.pointer.lock?this.setPointerLocked():e?(this.lastScreenPosition.set(t.screenX,t.screenY),this.dom.addEventListener("mousemove",this)):this.dom.removeEventListener("mousemove",this)}},{key:"handleAuxiliaryPointerButton",value:function(t,e){}},{key:"handleSecondaryPointerButton",value:function(t,e){}},{key:"handlePointerButtonEvent",value:function(t,e){switch(t.preventDefault(),t.button){case Qt:this.handleMainPointerButton(t,e);break;case Jt:this.handleAuxiliaryPointerButton(t,e);break;case Zt:this.handleSecondaryPointerButton(t,e)}}},{key:"handleTouchEvent",value:function(t,e){var n=t.touches[0];t.preventDefault(),e?(this.lastScreenPosition.set(n.screenX,n.screenY),this.dom.addEventListener("touchmove",this)):this.dom.removeEventListener("touchmove",this)}},{key:"handleKeyboardEvent",value:function(t,e){var n=this.settings.keyBindings;n.has(t.keyCode)&&(t.preventDefault(),this.strategies.get(n.get(t.keyCode)).execute(e))}},{key:"handleWheelEvent",value:function(t){this.rotationManager.zoom(Math.sign(t.deltaY))}},{key:"handlePointerLockEvent",value:function(){document.pointerLockElement===this.dom?this.dom.addEventListener("mousemove",this):this.dom.removeEventListener("mousemove",this)}},{key:"handleEvent",value:function(t){switch(t.type){case"mousemove":this.handlePointerMoveEvent(t);break;case"touchmove":this.handleTouchMoveEvent(t);break;case"mousedown":this.handlePointerButtonEvent(t,!0);break;case"mouseup":this.handlePointerButtonEvent(t,!1);break;case"touchstart":this.handleTouchEvent(t,!0);break;case"touchend":this.handleTouchEvent(t,!1);break;case"keydown":this.handleKeyboardEvent(t,!0);break;case"keyup":this.handleKeyboardEvent(t,!1);break;case"wheel":this.handleWheelEvent(t);break;case"pointerlockchange":this.handlePointerLockEvent()}}},{key:"update",value:function(t){this.rotationManager.update(t),this.translationManager.update(t)}},{key:"moveTo",value:function(t){return this.rotationManager.moveTo(t),this}},{key:"lookAt",value:function(t){return this.rotationManager.lookAt(t),this}},{key:"setPointerLocked",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?document.pointerLockElement!==this.dom&&void 0!==this.dom.requestPointerLock&&this.dom.requestPointerLock():void 0!==document.exitPointerLock&&document.exitPointerLock()}},{key:"setEnabled",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.dom;return this.translationManager.movementState.reset(),t&&!this.enabled?(document.addEventListener("pointerlockchange",this),document.body.addEventListener("keyup",this),document.body.addEventListener("keydown",this),e.addEventListener("mousedown",this),e.addEventListener("mouseup",this),e.addEventListener("touchstart",this),e.addEventListener("touchend",this),e.addEventListener("wheel",this)):!t&&this.enabled&&(document.removeEventListener("pointerlockchange",this),document.body.removeEventListener("keyup",this),document.body.removeEventListener("keydown",this),e.removeEventListener("mousedown",this),e.removeEventListener("mouseup",this),e.removeEventListener("touchstart",this),e.removeEventListener("touchend",this),e.removeEventListener("wheel",this),e.removeEventListener("mousemove",this),e.removeEventListener("touchmove",this)),this.setPointerLocked(!1),this.enabled=t,this}},{key:"dispose",value:function(){this.setEnabled(!1)}}]),t}(),we=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],Ae=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],Ee=function(e){function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return n(this,i),(t=l(this,s(i).call(this))).name="OctreeHelper",t.octree=e,t.update(),t}return r(i,e),o(i,[{key:"createLineSegments",value:function(e,n){var i,o,r,s,a,l,u,h,c,d,f,m,p,y,v,g,_=Math.pow(2,16)/8-1,b=new t.Group,x=new t.LineBasicMaterial({color:16777215*Math.random()});for(d=0,r=0,y=Math.ceil(n/_);y>0;--y){for(r+=n<_?n:_,n-=_,o=8*r,s=new Uint16Array(3*o),a=new Float32Array(3*o),m=0,p=0,i=e.next();!i.done&&d<r;){for(u=(l=i.value).min,h=l.max,f=0;f<12;++f)g=we[f],s[p++]=m+g[0],s[p++]=m+g[1];for(f=0;f<8;++f,++m)v=Ae[f],a[3*m]=0===v[0]?u.x:h.x,a[3*m+1]=0===v[1]?u.y:h.y,a[3*m+2]=0===v[2]?u.z:h.z;++d<r&&(i=e.next())}(c=new t.BufferGeometry).setIndex(new t.BufferAttribute(s,1)),c.setAttribute("position",new t.BufferAttribute(a,3)),b.add(new t.LineSegments(c,x))}this.add(b)}},{key:"update",value:function(){var t,e=null!==this.octree?this.octree.getDepth():-1,n=0;for(this.dispose();n<=e;)t=this.octree.findNodesByLevel(n),this.createLineSegments(t[Symbol.iterator](),"number"==typeof t.size?t.size:t.length),++n}},{key:"dispose",value:function(){var t,e,n,i,o,r,s=this.children;for(n=0,o=s.length;n<o;++n){for(i=0,r=(e=(t=s[n]).children).length;i<r;++i)e[i].geometry.dispose(),e[i].material.dispose();for(;e.length>0;)t.remove(e[0])}for(;s.length>0;)this.remove(s[0])}}]),i}(t.Group),Se=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],Ce=new Tt,Me=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Tt,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tt;n(this,t),this.min=e,this.max=i,this.children=null}return o(t,[{key:"getCenter",value:function(t){return t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(t){return t.subVectors(this.max,this.min)}},{key:"split",value:function(){var t,e,n=this.min,i=this.max,o=this.getCenter(Ce),r=this.children=[null,null,null,null,null,null,null,null];for(t=0;t<8;++t)e=Se[t],r[t]=new this.constructor(new Tt(0===e[0]?n.x:o.x,0===e[1]?n.y:o.y,0===e[2]?n.z:o.z),new Tt(0===e[0]?o.x:i.x,0===e[1]?o.y:i.y,0===e[2]?o.z:i.z))}}]),t}(),ze=function t(e,i,o){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;n(this,t),this.distance=e,this.distanceToRay=i,this.point=o,this.object=r};function Oe(t,e,n){var i,o,r,s,a,l,u,h,c,d,f,m=e.params.Points.threshold,p=m*m;for(a=0,u=t.length;a<u;++a)if(null!==(d=(c=t[a]).points))for(l=0,h=d.length;l<h;++l)f=d[l],(s=e.ray.distanceSqToPoint(f))<p&&(i=e.ray.closestPointToPoint(f,new Tt),(o=e.ray.origin.distanceTo(i))>=e.near&&o<=e.far&&(r=Math.sqrt(s),n.push(new ze(o,r,i,c.data[l]))))}var Pe=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])];function Te(t,e,n,i){var o,r=0;return e<n?(o=e,r=0):(o=n,r=1),i<o&&(r=2),Pe[t][r]}var Le=new Tt,De=new Ft,Fe=new Ft,Re=new Yt;function Be(t,e,n){var i,o,r,s,a,l,u,h,c,d=De.min.set(0,0,0),f=De.max.subVectors(t.max,t.min),m=t.getDimensions(Fe.min),p=Fe.max.copy(m).multiplyScalar(.5),y=Re.origin.copy(e.origin),v=Re.direction.copy(e.direction);return y.sub(t.getCenter(Le)).add(p),n.value=0,v.x<0&&(y.x=m.x-y.x,v.x=-v.x,n.value|=4),v.y<0&&(y.y=m.y-y.y,v.y=-v.y,n.value|=2),v.z<0&&(y.z=m.z-y.z,v.z=-v.z,n.value|=1),i=1/v.x,o=1/v.y,r=1/v.z,s=(d.x-y.x)*i,a=(f.x-y.x)*i,l=(d.y-y.y)*o,u=(f.y-y.y)*o,h=(d.z-y.z)*r,c=(f.z-y.z)*r,Math.max(Math.max(s,l),h)<Math.min(Math.min(a,u),c)?[s,l,h,a,u,c]:null}var Ne=new function t(){n(this,t),this.value=0};function He(t,e,n,i,o,r,s,a){if(o>=0&&r>=0&&s>=0){var l=t.children;if(null===l)a.push(t);else{var u=.5*(e+o),h=.5*(n+r),c=.5*(i+s),d=Ne.value,f=function(t,e,n,i,o,r){var s=0;return t>e&&t>n?(o<t&&(s|=2),r<t&&(s|=1)):e>n?(i<e&&(s|=4),r<e&&(s|=1)):(i<n&&(s|=4),o<n&&(s|=2)),s}(e,n,i,u,h,c);do{switch(f){case 0:He(l[d],e,n,i,u,h,c,a),f=Te(f,u,h,c);break;case 1:He(l[1^d],e,n,c,u,h,s,a),f=Te(f,u,h,s);break;case 2:He(l[2^d],e,h,i,u,r,c,a),f=Te(f,u,r,c);break;case 3:He(l[3^d],e,h,c,u,r,s,a),f=Te(f,u,r,s);break;case 4:He(l[4^d],u,n,i,o,h,c,a),f=Te(f,o,h,c);break;case 5:He(l[5^d],u,n,c,o,h,s,a),f=Te(f,o,h,s);break;case 6:He(l[6^d],u,h,i,o,r,c,a),f=Te(f,o,r,c);break;case 7:He(l[7^d],u,h,c,o,r,s,a),f=8}}while(f<8)}}}var Ve=function(){function t(){n(this,t)}return o(t,null,[{key:"intersectOctree",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=Be(t,e,Ne);null!==i&&He.apply(void 0,[t.root].concat(h(i),[n]))}}]),t}(),je=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n(this,t),this.value=e,this.done=i}return o(t,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),t}(),Ue=new Ft,Ie=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;n(this,t),this.octree=e,this.region=i,this.cull=null!==i,this.result=new je,this.trace=null,this.indices=null,this.reset()}return o(t,[{key:"reset",value:function(){var t=this.octree.root;return this.trace=[],this.indices=[],null!==t&&(Ue.min=t.min,Ue.max=t.max,this.cull&&!this.region.intersectsBox(Ue)||(this.trace.push(t),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var t,e,n,i=this.cull,o=this.region,r=this.indices,s=this.trace,a=null,l=s.length-1;null===a&&l>=0;)if(t=r[l]++,e=s[l].children,t<8)if(null!==e){if(n=e[t],i&&(Ue.min=n.min,Ue.max=n.max,!o.intersectsBox(Ue)))continue;s.push(n),r.push(0),++l}else a=s.pop(),r.pop();else s.pop(),r.pop(),--l;return this.result.value=a,this.result.done=null===a,this.result}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),qe=new Ft;var Ge=function(){function t(e){n(this,t),this.root=e}return o(t,[{key:"getCenter",value:function(t){return this.root.getCenter(t)}},{key:"getDimensions",value:function(t){return this.root.getDimensions(t)}},{key:"cull",value:function(t){var e=[];return function t(e,n,i){var o,r,s=e.children;if(qe.min=e.min,qe.max=e.max,n.intersectsBox(qe))if(null!==s)for(o=0,r=s.length;o<r;++o)t(s[o],n,i);else i.push(e)}(this.root,t,e),e}},{key:"getDepth",value:function(){return function t(e){var n,i,o,r=e.children,s=0;if(null!==r)for(n=0,i=r.length;n<i;++n)(o=1+t(r[n]))>s&&(s=o);return s}(this.root)}},{key:"findNodesByLevel",value:function(t){var e=[];return function t(e,n,i,o){var r,s,a=e.children;if(i===n)o.push(e);else if(null!==a)for(++i,r=0,s=a.length;r<s;++r)t(a[r],n,i,o)}(this.root,t,0,e),e}},{key:"raycast",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Ve.intersectOctree(this,t.ray,e),e}},{key:"leaves",value:function(t){return new Ie(this,t)}},{key:Symbol.iterator,value:function(){return new Ie(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),t}(),Xe=new Tt,We=function(t){function e(t,i){var o;return n(this,e),(o=l(this,s(e).call(this,t,i))).points=null,o.data=null,o}return r(e,t),o(e,[{key:"distanceToSquared",value:function(t){return Xe.copy(t).clamp(this.min,this.max).sub(t).lengthSquared()}},{key:"distanceToCenterSquared",value:function(t){var e=this.getCenter(Xe),n=t.x-e.x,i=t.y-e.x,o=t.z-e.z;return n*n+i*i+o*o}},{key:"contains",value:function(t,e){var n=this.min,i=this.max;return t.x>=n.x-e&&t.y>=n.y-e&&t.z>=n.z-e&&t.x<=i.x+e&&t.y<=i.y+e&&t.z<=i.z+e}},{key:"redistribute",value:function(t){var e,n,i,o,r,s,a,l=this.children,u=this.points,h=this.data;if(null!==l&&null!==u){for(e=0,i=u.length;e<i;++e)for(s=u[e],a=h[e],n=0,o=l.length;n<o;++n)if((r=l[n]).contains(s,t)){null===r.points&&(r.points=[],r.data=[]),r.points.push(s),r.data.push(a);break}this.points=null,this.data=null}}},{key:"merge",value:function(){var t=this.children;if(null!==t){var e,n,i,o=[],r=[];for(e=0,n=t.length;e<n;++e)null!==(i=t[e]).points&&(o=o.concat(i.points),r=r.concat(i.data));this.children=null,this.points=o,this.data=r}}}]),e}(Me);function Ye(t){var e,n,i=t.children,o=0;if(null!==i)for(e=0,n=i.length;e<n;++e)o+=Ye(i[e]);else null!==t.points&&(o=t.points.length);return o}function Ke(t,e,n,i,o){var r,s,a=i.children,l=!1,u=!1;if(i.contains(t,n.bias)){if(null===a){if(null===i.points)i.points=[],i.data=[];else for(r=0,s=i.points.length;!l&&r<s;++r)l=i.points[r].equals(t);l?(i.data[r-1]=e,u=!0):i.points.length<n.maxPoints||o===n.maxDepth?(i.points.push(t.clone()),i.data.push(e),++n.pointCount,u=!0):(i.split(),i.redistribute(n.bias),a=i.children)}if(null!==a)for(++o,r=0,s=a.length;!u&&r<s;++r)u=Ke(t,e,n,a[r],o)}return u}function Qe(t,e,n,i){var o,r,s,a,l,u=n.children,h=null;if(n.contains(t,e.bias))if(null!==u)for(o=0,r=u.length;null===h&&o<r;++o)h=Qe(t,e,u[o],n);else if(null!==n.points)for(s=n.points,a=n.data,o=0,r=s.length;o<r;++o)if(s[o].equals(t)){l=r-1,h=a[o],o<l&&(s[o]=s[l],a[o]=a[l]),s.pop(),a.pop(),--e.pointCount,null!==i&&Ye(i)<=e.maxPoints&&i.merge();break}return h}function Je(t,e,n,i){var o,r,s=null,a=e;if(null!==i.children){var l,u,h=i.children.map((function(e){return{octant:e,distance:e.distanceToCenterSquared(t)}})).sort((function(t,e){return t.distance-e.distance}));for(o=0,r=h.length;o<r&&(!(l=h[o].octant).contains(t,a)||null===(u=Je(t,a,n,l))||(s=u,0!==(a=u.distance)));++o);}else if(null!==i.points){var c,d=i.points,f=-1;for(o=0,r=d.length;o<r;++o)if(d[o].equals(t)){if(!n){a=0,f=o;break}}else(c=t.distanceTo(d[o]))<a&&(a=c,f=o);f>=0&&(s={point:d[f],data:i.data[f],distance:a})}return s}function Ze(t,e,n,i,o){var r,s,a,l=i.children;if(null!==l)for(r=0,s=l.length;r<s;++r)(a=l[r]).contains(t,e)&&Ze(t,e,n,a,o);else if(null!==i.points){var u,h=i.points,c=e*e;for(r=0,s=h.length;r<s;++r)(u=h[r]).equals(t)?n||o.push({point:u.clone(),data:i.data[r]}):u.distanceToSquared(t)<=c&&o.push({point:u.clone(),data:i.data[r]})}}var $e,tn=function(t){function e(t,i){var o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;return n(this,e),(o=l(this,s(e).call(this,new We(t,i)))).bias=Math.max(0,r),o.maxPoints=Math.max(1,Math.round(a)),o.maxDepth=Math.max(0,Math.round(u)),o.pointCount=0,o}return r(e,t),o(e,[{key:"countPoints",value:function(t){return Ye(t)}},{key:"insert",value:function(t,e){return Ke(t,e,this,this.root,0)}},{key:"remove",value:function(t){return Qe(t,this,this.root,null)}},{key:"get",value:function(t){return function t(e,n,i){var o,r,s,a=i.children,l=null;if(i.contains(e,n.bias))if(null!==a)for(o=0,r=a.length;null===l&&o<r;++o)l=t(e,n,a[o]);else if(null!==i.points)for(o=0,r=(s=i.points).length;null===l&&o<r;++o)e.equals(s[o])&&(l=i.data[o]);return l}(t,this,this.root)}},{key:"move",value:function(t,e){return function t(e,n,i,o,r,s){var a,l,u,h=o.children,c=null;if(o.contains(e,i.bias))if(o.contains(n,i.bias)){if(null!==h)for(++s,a=0,l=h.length;null===c&&a<l;++a)c=t(e,n,i,h[a],o,s);else if(null!==o.points)for(a=0,l=(u=o.points).length;a<l;++a)if(e.equals(u[a])){u[a].copy(n),c=o.data[a];break}}else Ke(n,c=Qe(e,i,o,r),i,r,s-1);return c}(t,e,this,this.root,null,0)}},{key:"findNearestPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Je(t,e,n,this.root);return null!==i&&(i.point=i.point.clone()),i}},{key:"findPoints",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=[];return Ze(t,e,n,this.root,i),i}},{key:"raycast",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=u(s(e.prototype),"raycast",this).call(this,t);return i.length>0&&Oe(i,t,n),n}}]),e}(Ge),en=new t.Vector2,nn=function(e){function i(e,o,r){var a;return n(this,i),(a=l(this,s(i).call(this))).params.Points.threshold=.1,a.octree=e,a.camera=o,a.object=r,a.enabled=!0,a.delta="",a.selectedObject=null,a.selectedPoint=new t.Mesh(new t.SphereBufferGeometry(.2,16,16),new t.MeshBasicMaterial({transparent:!0,color:52479,opacity:.75})),a.selectedPoint.visible=!1,a}return r(i,e),o(i,[{key:"handleEvent",value:function(t){switch(t.type){case"mousemove":this.raycast(t)}}},{key:"raycast",value:function(t){var e,n,i,o;en.x=t.clientX/window.innerWidth*2-1,en.y=-t.clientY/window.innerHeight*2+1,this.setFromCamera(en,this.camera),this.enabled?(n=performance.now(),e=this.octree.raycast(this),i=performance.now()):(n=performance.now(),e=this.intersectObjects(this.object.children),i=performance.now()),this.delta=(i-n).toFixed(2)+" ms",null!==this.selectedObject&&(this.selectedObject.material.color.setHex(12582912),this.selectedObject=null,this.selectedPoint.visible=!1),e.length>0&&(void 0!==(o=e[0]).object?(this.selectedObject=o.object,this.selectedObject.material.color.setHex(13434624),this.selectedPoint.visible=o.object.parent.visible,this.selectedPoint.position.copy(o.point)):console.warn(e))}},{key:"registerOptions",value:function(t){var e=t.addFolder("Raycasting");e.add(this,"enabled"),e.add(this,"delta").listen(),e.open()}}]),i}(t.Raycaster),on=new t.Matrix4,rn=new t.Frustum,sn=function(){function e(i,o){n(this,e),this.octree=i,this.scene=o,this.enabled=!1,this.cullCamera=new t.PerspectiveCamera(20,1.77,.5,5),this.s=new t.Spherical(5,Math.PI/3,1.75*Math.PI),this.delta="",this.culledOctants=new t.Points(new t.BufferGeometry,new t.PointsMaterial({color:13434624,sizeAttenuation:!1,size:2})),this.culledOctants.visible=!1,this.cameraHelper=new t.CameraHelper(this.cullCamera),this.cameraHelper.visible=!1}return o(e,[{key:"updateCamera",value:function(){var t=this.cullCamera;t.position.setFromSpherical(this.s),t.lookAt(this.scene.position),t.updateMatrixWorld(!0),rn.setFromMatrix(on.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse))}},{key:"cull",value:function(){var e,n,i,o,r,s,a,l=this.culledOctants;if(this.enabled)if(this.updateCamera(),e=performance.now(),s=this.octree.cull(rn),this.delta=(performance.now()-e).toFixed(2)+" ms",s.length>0){for(a=new Float32Array(3*s.length*2),n=0,i=0,o=s.length;n<o;++n)r=s[n],a[i++]=r.min.x,a[i++]=r.min.y,a[i++]=r.min.z,a[i++]=r.max.x,a[i++]=r.max.y,a[i++]=r.max.z;l.geometry.removeAttribute("position"),l.geometry.addAttribute("position",new t.BufferAttribute(a,3)),this.scene.remove(l),this.scene.add(l)}else this.scene.remove(l)}},{key:"registerOptions",value:function(t){var e=this,n=t.addFolder("Frustum Culling");n.add(this,"enabled").onChange((function(){e.cameraHelper.visible=e.culledOctants.visible=e.enabled,e.cull()})),n.add(this,"delta").listen(),n.open();var i=n.addFolder("Camera Adjustment");i.add(this.s,"radius").min(.1).max(10).step(.1).onChange((function(){e.cull()})),i.add(this.s,"phi").min(1e-6).max(Math.PI-1e-6).onChange((function(){e.cull()})),i.add(this.s,"theta").min(0).max(2*Math.PI).onChange((function(){e.cull()}))}}]),e}(),an=function(e){function i(){var t;return n(this,i),(t=l(this,s(i).call(this,"point-octree"))).points=null,t.octreeHelper=null,t.octreeRaycaster=null,t.frustumCuller=null,t}return r(i,e),o(i,[{key:"initialize",value:function(){var e=this.scene,n=this.renderer,i=new t.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.3,2e3);i.position.set(10,6,10),this.camera=i;var o=new ke(i.position,i.quaternion,n.domElement);o.settings.pointer.lock=!1,o.settings.zoom.maxDistance=60,o.settings.sensitivity.translation=10,o.settings.sensitivity.zoom=1,o.lookAt(e.position),this.controls=o,i.updateMatrixWorld(),e.fog=new t.FogExp2(855309,.025),n.setClearColor(e.fog.color);var r=function(){function e(e,n,i,o){var r,s,a,l,u,h=new t.BufferGeometry,c=new Float32Array(3*e),d=n/2;for(l=0,u=c.length;l<u;l+=3)r=Math.random()*n-d,s=Math.random()*n-d,a=i+(Math.random()*o*2-o),c[l]=r,c[l+1]=s,c[l+2]=a;return h.addAttribute("position",new t.BufferAttribute(c,3)),h}var n,i=new t.Object3D,o=8,r=6/(o-1),s=-3,a=new t.PointsMaterial({color:12582912,sizeAttenuation:!1,size:1});for(console.log("Generating",65536*o,"points...");o-- >0;)n=new t.Points(e(65536,6,s,.25),a),a=a.clone(),s+=r,i.add(n);return i}();this.points=r,e.add(r);var s=function(n){var i=new t.Vector3,o=new t.Box3;o.setFromObject(e);var r,s,a,l,u,h=performance.now(),c=new tn(o.min,o.max,0,8,5);for(r=n.children.length-1;r>=0;--r)for(a=0,l=(u=(s=n.children[r]).geometry.getAttribute("position").array).length;a<l;a+=3)c.insert(i.fromArray(u,a),s);return console.log("Octree:",c,"created in",(performance.now()-h).toFixed(2)+" ms"),c}(r),a=function(t){var e=performance.now(),n=new Ee(t);return n.visible=!1,console.log("OctreeHelper:",n,"created in",(performance.now()-e).toFixed(2)+" ms"),n}(s);this.octreeHelper=a,e.add(a),this.raycaster=new nn(s,i,r),n.domElement.addEventListener("mousemove",this.raycaster),e.add(this.raycaster.selectedPoint),this.frustumCuller=new sn(s,e),e.add(this.frustumCuller.cameraHelper)}},{key:"render",value:function(t){this.controls.update(t),u(s(i.prototype),"render",this).call(this,t)}},{key:"registerOptions",value:function(t){var e=this.points,n=this.octreeHelper;this.raycaster.registerOptions(t),this.frustumCuller.registerOptions(t);var i={"level mask":n.children.length},o=t.addFolder("Points");o.add(e,"visible"),o.open(),(o=t.addFolder("Octree Helper")).add(n,"visible"),o.add(i,"level mask").min(0).max(n.children.length).step(1).onChange((function(){var t,e;for(t=0,e=n.children.length;t<e;++t)n.children[t].visible=i["level mask"]===n.children.length||t===i["level mask"]})),o.open()}},{key:"reset",value:function(){return u(s(i.prototype),"reset",this).call(this),this.renderer.domElement.removeEventListener("mousemove",this.raycaster),this}}]),i}(_t);function ln(t){requestAnimationFrame(ln),$e.render(t)}function un(t){document.getElementById("viewport").children[0].style.display="initial"}function hn(t){document.getElementById("viewport").children[0].style.display="none"}window.addEventListener("load",(function(e){var n=document.getElementById("viewport"),i=new t.WebGLRenderer({antialias:!0});i.setSize(n.clientWidth,n.clientHeight),i.setPixelRatio(window.devicePixelRatio),i.setClearColor(0),($e=new wt(n,{aside:document.getElementById("aside"),renderer:i})).addEventListener("change",un),$e.addEventListener("load",hn);var o=new an;o.id!==window.location.hash.slice(1)&&(window.location.hash=""),$e.addDemo(o),ln()})),window.addEventListener("resize",function(){var t=0;function e(e){var n=e.target.innerWidth,i=e.target.innerHeight;$e.setSize(n,i),t=0}return function(n){0===t&&(t=setTimeout(e,66,n))}}()),document.addEventListener("keydown",(function(t){var e=this.getElementById("aside");t.altKey&&null!==e&&(t.preventDefault(),e.style.visibility="hidden"===e.style.visibility?"visible":"hidden")}))}(THREE);
