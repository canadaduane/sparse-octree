/**
 * sparse-octree v6.0.0 build Wed Oct 23 2019
 * https://github.com/vanruesc/sparse-octree
 * Copyright 2019 Raoul van RÃ¼schen, Zlib
 */
"use strict";function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}(function(a,b){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):(a=a||self,b(a.SPARSEOCTREE={}))})(void 0,function(a){'use strict';var K=Math.round,L=Math.abs,M=Math.min,N=Math.max,O=Math.sqrt;function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function g(a,b,c){return b&&f(a.prototype,b),c&&f(a,c),a}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&j(a,b)}function i(a){return i=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},i(a)}function j(a,b){return j=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},j(a,b)}function k(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function l(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:k(a)}function m(a,b){for(;!Object.prototype.hasOwnProperty.call(a,b)&&(a=i(a),null!==a););return a}function n(a,b,c){return n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(a,b,c){var d=m(a,b);if(d){var e=Object.getOwnPropertyDescriptor(d,b);return e.get?e.get.call(c):e.value}},n(a,b,c||a)}function o(a){return q(a)||s(a)||t()}function q(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function s(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function t(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function u(a,b,c){var d,e,f,g,h,k,l,m,n,o,p,q=b.params.Points.threshold;for(h=0,l=a.length;h<l;++h)if(n=a[h],o=n.points,null!==o)for(k=0,m=o.length;k<m;++k)p=o[k],g=b.ray.distanceSqToPoint(p),g<q*q&&(d=b.ray.closestPointToPoint(p,new R),e=b.ray.origin.distanceTo(d),e>=b.near&&e<=b.far&&(f=O(g),c.push(new Z(e,f,d,n.data[k]))))}function w(a,b,c,d,e,f){var g=0;return a>b&&a>c?(e<a&&(g|=2),f<a&&(g|=1)):b>c?(d<b&&(g|=4),f<b&&(g|=1)):(d<c&&(g|=4),e<c&&(g|=2)),g}function x(a,b,c,d){var e,f=0;return b<c?(e=b,f=0):(e=c,f=1),d<e&&(f=2),_[a][f]}function y(a,c,e){var f,g,h,i,j,k,l,m,n,o=ba.min.set(0,0,0),p=ba.max.subVectors(a.max,a.min),q=a.getDimensions(b.min),r=b.max.copy(q).multiplyScalar(.5),s=d.origin.copy(c.origin),t=d.direction.copy(c.direction);return s.sub(a.getCenter(aa)).add(r),e.value=0,0>t.x&&(s.x=q.x-s.x,t.x=-t.x,e.value|=4),0>t.y&&(s.y=q.y-s.y,t.y=-t.y,e.value|=2),0>t.z&&(s.z=q.z-s.z,t.z=-t.z,e.value|=1),f=1/t.x,g=1/t.y,h=1/t.z,i=(o.x-s.x)*f,j=(p.x-s.x)*f,k=(o.y-s.y)*g,l=(p.y-s.y)*g,m=(o.z-s.z)*h,n=(p.z-s.z)*h,N(N(i,k),m)<M(M(j,l),n)?[i,k,m,j,l,n]:null}function z(a,b,c,d,e,g,h,i){if(0<=e&&0<=g&&0<=h){var j=a.children;if(null===j)i.push(a);else{var k=.5*(b+e),l=.5*(c+g),m=.5*(d+h),n=r.value,f=w(b,c,d,k,l,m);do 0===f?(z(j[n],b,c,d,k,l,m,i),f=x(f,k,l,m)):1===f?(z(j[1^n],b,c,m,k,l,h,i),f=x(f,k,l,h)):2===f?(z(j[2^n],b,l,d,k,g,m,i),f=x(f,k,g,m)):3===f?(z(j[3^n],b,l,m,k,g,h,i),f=x(f,k,g,h)):4===f?(z(j[4^n],k,c,d,e,l,m,i),f=x(f,e,l,m)):5===f?(z(j[5^n],k,c,m,e,l,h,i),f=x(f,e,l,h)):6===f?(z(j[6^n],k,l,d,e,g,m,i),f=x(f,e,g,m)):7===f?(z(j[7^n],k,l,m,e,g,h,i),f=8):void 0;while(8>f)}}}function A(a){var b,c,e,f=a.children,g=0;if(null!==f)for(b=0,c=f.length;b<c;++b)e=1+A(f[b]),e>g&&(g=e);return g}function B(a,b,c){var d,e,f=a.children;if(ga.min=a.min,ga.max=a.max,b.intersectsBox(ga))if(null!==f)for(d=0,e=f.length;d<e;++d)B(f[d],b,c);else c.push(a)}function C(a,b,c,d){var e,f,g=a.children;if(c===b)d.push(a);else if(null!==g)for(++c,e=0,f=g.length;e<f;++e)C(g[e],b,c,d)}function D(a){var b,c,d=a.children,e=0;if(null!==d)for(b=0,c=d.length;b<c;++b)e+=D(d[b]);else null!==a.points&&(e=a.points.length);return e}function E(a,b,c,d,e){var f,g,h=d.children,j=!1,k=!1;if(d.contains(a,c.bias)){if(null===h){if(null===d.points)d.points=[],d.data=[];else for(f=0,g=d.points.length;!j&&f<g;++f)j=d.points[f].equals(a);j?(d.data[f-1]=b,k=!0):d.points.length<c.maxPoints||e===c.maxDepth?(d.points.push(a.clone()),d.data.push(b),++c.pointCount,k=!0):(d.split(),d.redistribute(c.bias),h=d.children)}if(null!==h)for(++e,f=0,g=h.length;!k&&f<g;++f)k=E(a,b,c,h[f],e)}return k}function F(a,b,c,d){var e,f,g,h,j,k=c.children,m=null;if(c.contains(a,b.bias))if(null!==k)for(e=0,f=k.length;null===m&&e<f;++e)m=F(a,b,k[e],c);else if(null!==c.points)for(g=c.points,h=c.data,(e=0,f=g.length);e<f;++e)if(g[e].equals(a)){j=f-1,m=h[e],e<j&&(g[e]=g[j],h[e]=h[j]),g.pop(),h.pop(),--b.pointCount,null!==d&&D(d)<=b.maxPoints&&d.merge();break}return m}function G(a,b,c){var d,e,f,g=c.children,h=null;if(c.contains(a,b.bias))if(null!==g)for(d=0,e=g.length;null===h&&d<e;++d)h=G(a,b,g[d]);else if(null!==c.points)for(f=c.points,d=0,e=f.length;null===h&&d<e;++d)a.equals(f[d])&&(h=c.data[d]);return h}function H(a,b,c,d,e,f){var g,h,j,k=d.children,m=null;if(d.contains(a,c.bias))if(!d.contains(b,c.bias))m=F(a,c,d,e),E(b,m,c,e,f-1);else if(null!==k)for(++f,g=0,h=k.length;null===m&&g<h;++g)m=H(a,b,c,k[g],d,f);else if(null!==d.points)for(j=d.points,g=0,h=j.length;g<h;++g)if(a.equals(j[g])){j[g].copy(b),m=d.data[g];break}return m}function I(a,b,c,d){var e,f,g=null,h=b;if(null!==d.children){var j,k,m=d.children.map(function(b){return{octant:b,distance:b.distanceToCenterSquared(a)}}).sort(function(c,a){return c.distance-a.distance});for(e=0,f=m.length;e<f&&(j=m[e].octant,!(j.contains(a,h)&&(k=I(a,h,c,j),null!==k&&(h=k.distance,g=k,0===h))));++e);}else if(null!==d.points){var n,o=d.points,p=-1;for(e=0,f=o.length;e<f;++e)if(!o[e].equals(a))n=a.distanceTo(o[e]),n<h&&(h=n,p=e);else if(!c){h=0,p=e;break}0<=p&&(g={point:o[p],data:d.data[p],distance:h})}return g}function J(a,b,c,d,e){var f,g,h=d.children;if(null!==h){var j;for(f=0,g=h.length;f<g;++f)j=h[f],j.contains(a,b)&&J(a,b,c,j,e)}else if(null!==d.points){var k,m=d.points;for(f=0,g=m.length;f<g;++f)k=m[f],k.equals(a)?!c&&e.push({point:k.clone(),data:d.data[f]}):k.distanceToSquared(a)<=b*b&&e.push({point:k.clone(),data:d.data[f]})}}var P=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],Q=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],R=function(){var b=Math.cos,c=Math.sin;function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,a),this.x=b,this.y=c,this.z=d}return g(a,[{key:"set",value:function(a,b,c){return this.x=a,this.y=b,this.z=c,this}},{key:"copy",value:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=a[b],this.y=a[b+1],this.z=a[b+2],this}},{key:"toArray",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a}},{key:"setFromSpherical",value:function(a){this.setFromSphericalCoords(a.radius,a.phi,a.theta)}},{key:"setFromSphericalCoords",value:function(a,d,e){var f=c(d)*a;return this.x=f*c(e),this.y=b(d)*a,this.z=f*b(e),this}},{key:"setFromCylindrical",value:function(a){this.setFromCylindricalCoords(a.radius,a.theta,a.y)}},{key:"setFromCylindricalCoords",value:function(a,d,e){return this.x=a*c(d),this.y=e,this.z=a*b(d),this}},{key:"setFromMatrixColumn",value:function(a,b){return this.fromArray(a.elements,4*b)}},{key:"setFromMatrixPosition",value:function(a){var b=a.elements;return this.x=b[12],this.y=b[13],this.z=b[14],this}},{key:"setFromMatrixScale",value:function(a){var b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,1).length(),d=this.setFromMatrixColumn(a,2).length();return this.x=b,this.y=c,this.z=d,this}},{key:"add",value:function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this}},{key:"addScalar",value:function(a){return this.x+=a,this.y+=a,this.z+=a,this}},{key:"addVectors",value:function(c,a){return this.x=c.x+a.x,this.y=c.y+a.y,this.z=c.z+a.z,this}},{key:"addScaledVector",value:function(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this}},{key:"sub",value:function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this}},{key:"subScalar",value:function(a){return this.x-=a,this.y-=a,this.z-=a,this}},{key:"subVectors",value:function(c,a){return this.x=c.x-a.x,this.y=c.y-a.y,this.z=c.z-a.z,this}},{key:"multiply",value:function(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this}},{key:"multiplyScalar",value:function(a){return this.x*=a,this.y*=a,this.z*=a,this}},{key:"multiplyVectors",value:function(c,a){return this.x=c.x*a.x,this.y=c.y*a.y,this.z=c.z*a.z,this}},{key:"divide",value:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this}},{key:"divideScalar",value:function(a){return this.x/=a,this.y/=a,this.z/=a,this}},{key:"crossVectors",value:function(c,a){var b=c.x,d=c.y,e=c.z,f=a.x,g=a.y,h=a.z;return this.x=d*h-e*g,this.y=e*f-b*h,this.z=b*g-d*f,this}},{key:"cross",value:function(a){return this.crossVectors(this,a)}},{key:"transformDirection",value:function(a){var b=this.x,c=this.y,d=this.z,f=a.elements;return this.x=f[0]*b+f[4]*c+f[8]*d,this.y=f[1]*b+f[5]*c+f[9]*d,this.z=f[2]*b+f[6]*c+f[10]*d,this.normalize()}},{key:"applyMatrix3",value:function(a){var b=this.x,c=this.y,d=this.z,f=a.elements;return this.x=f[0]*b+f[3]*c+f[6]*d,this.y=f[1]*b+f[4]*c+f[7]*d,this.z=f[2]*b+f[5]*c+f[8]*d,this}},{key:"applyMatrix4",value:function(a){var b=this.x,c=this.y,d=this.z,f=a.elements;return this.x=f[0]*b+f[4]*c+f[8]*d+f[12],this.y=f[1]*b+f[5]*c+f[9]*d+f[13],this.z=f[2]*b+f[6]*c+f[10]*d+f[14],this}},{key:"applyQuaternion",value:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z,h=a.w,i=h*b+f*d-g*c,j=h*c+g*b-e*d,k=h*d+e*c-f*b,l=-e*b-f*c-g*d;return this.x=i*h+l*-e+j*-g-k*-f,this.y=j*h+l*-f+k*-e-i*-g,this.z=k*h+l*-g+i*-f-j*-e,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(a){return this.x*a.x+this.y*a.y+this.z*a.z}},{key:"reflect",value:function(a){var b=a.x,c=a.y,d=a.z;return this.sub(a.multiplyScalar(2*this.dot(a))),a.set(b,c,d),this}},{key:"angleTo",value:function(a){var b=Math.acos,c=this.dot(a)/O(this.lengthSquared()*a.lengthSquared());return b(M(N(c,-1),1))}},{key:"manhattanLength",value:function(){return L(this.x)+L(this.y)+L(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return O(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanDistanceTo",value:function(a){return L(this.x-a.x)+L(this.y-a.y)+L(this.z-a.z)}},{key:"distanceToSquared",value:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d}},{key:"distanceTo",value:function(a){return O(this.distanceToSquared(a))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(a){return this.normalize().multiplyScalar(a)}},{key:"min",value:function(a){return this.x=M(this.x,a.x),this.y=M(this.y,a.y),this.z=M(this.z,a.z),this}},{key:"max",value:function(a){return this.x=N(this.x,a.x),this.y=N(this.y,a.y),this.z=N(this.z,a.z),this}},{key:"clamp",value:function(a,b){return this.x=N(a.x,M(b.x,this.x)),this.y=N(a.y,M(b.y,this.y)),this.z=N(a.z,M(b.z,this.z)),this}},{key:"floor",value:function(){var a=Math.floor;return this.x=a(this.x),this.y=a(this.y),this.z=a(this.z),this}},{key:"ceil",value:function(){var a=Math.ceil;return this.x=a(this.x),this.y=a(this.y),this.z=a(this.z),this}},{key:"round",value:function(){return this.x=K(this.x),this.y=K(this.y),this.z=K(this.z),this}},{key:"lerp",value:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this}},{key:"lerpVectors",value:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)}},{key:"equals",value:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z}}]),a}(),S=new R,v=[new R,new R,new R,new R,new R,new R,new R,new R],T=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new R(1/0,1/0,1/0),c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R(-Infinity,-Infinity,-Infinity);e(this,a),this.min=b,this.max=c}return g(a,[{key:"set",value:function(a,b){return this.min.copy(a),this.max.copy(b),this}},{key:"copy",value:function(a){return this.min.copy(a.min),this.max.copy(a.max),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-Infinity,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new R;return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new R;return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)}},{key:"setFromSphere",value:function(a){return this.set(a.center,a.center),this.expandByScalar(a.radius),this}},{key:"expandByPoint",value:function(a){return this.min.min(a),this.max.max(a),this}},{key:"expandByVector",value:function(a){return this.min.sub(a),this.max.add(a),this}},{key:"expandByScalar",value:function(a){return this.min.addScalar(-a),this.max.addScalar(a),this}},{key:"setFromPoints",value:function(a){var b,c;for(this.min.set(0,0,0),this.max.set(0,0,0),(b=0,c=a.length);b<c;++b)this.expandByPoint(a[b]);return this}},{key:"setFromCenterAndSize",value:function(a,b){var c=S.copy(b).multiplyScalar(.5);return this.min.copy(a).sub(c),this.max.copy(a).add(c),this}},{key:"clampPoint",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R;return b.copy(a).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(a){var b=S.copy(a).clamp(this.min,this.max);return b.sub(a).length()}},{key:"applyMatrix4",value:function(a){var b=this.min,c=this.max;return this.isEmpty()||(v[0].set(b.x,b.y,b.z).applyMatrix4(a),v[1].set(b.x,b.y,c.z).applyMatrix4(a),v[2].set(b.x,c.y,b.z).applyMatrix4(a),v[3].set(b.x,c.y,c.z).applyMatrix4(a),v[4].set(c.x,b.y,b.z).applyMatrix4(a),v[5].set(c.x,b.y,c.z).applyMatrix4(a),v[6].set(c.x,c.y,b.z).applyMatrix4(a),v[7].set(c.x,c.y,c.z).applyMatrix4(a),this.setFromPoints(v)),this}},{key:"translate",value:function(a){return this.min.add(a),this.max.add(a),this}},{key:"intersect",value:function(a){return this.min.max(a.min),this.max.min(a.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(a){return this.min.min(a.min),this.max.max(a.max),this}},{key:"containsPoint",value:function(a){var b=this.min,c=this.max;return a.x>=b.x&&a.y>=b.y&&a.z>=b.z&&a.x<=c.x&&a.y<=c.y&&a.z<=c.z}},{key:"containsBox",value:function(a){var b=this.min,c=this.max,d=a.min,e=a.max;return b.x<=d.x&&e.x<=c.x&&b.y<=d.y&&e.y<=c.y&&b.z<=d.z&&e.z<=c.z}},{key:"intersectsBox",value:function(a){var b=this.min,c=this.max,d=a.min,e=a.max;return e.x>=b.x&&e.y>=b.y&&e.z>=b.z&&d.x<=c.x&&d.y<=c.y&&d.z<=c.z}},{key:"intersectsSphere",value:function(a){var b=this.clampPoint(a.center,S);return b.distanceToSquared(a.center)<=a.radius*a.radius}},{key:"intersectsPlane",value:function(a){var b,c;return 0<a.normal.x?(b=a.normal.x*this.min.x,c=a.normal.x*this.max.x):(b=a.normal.x*this.max.x,c=a.normal.x*this.min.x),0<a.normal.y?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y),0<a.normal.z?(b+=a.normal.z*this.min.z,c+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z),b<=-a.constant&&c>=-a.constant}},{key:"equals",value:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}}]),a}(),U=[new R,new R,new R,new R],V=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new R,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R;e(this,a),this.origin=b,this.direction=c}return g(a,[{key:"set",value:function(a,b){return this.origin.copy(a),this.direction.copy(b),this}},{key:"copy",value:function(a){return this.origin.copy(a.origin),this.direction.copy(a.direction),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"at",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R;return b.copy(this.direction).multiplyScalar(a).add(this.origin)}},{key:"lookAt",value:function(a){return this.direction.copy(a).sub(this.origin).normalize(),this}},{key:"recast",value:function(a){return this.origin.copy(this.at(a,U[0])),this}},{key:"closestPointToPoint",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R,c=b.subVectors(a,this.origin).dot(this.direction);return 0<=c?b.copy(this.direction).multiplyScalar(c).add(this.origin):b.copy(this.origin)}},{key:"distanceSquaredToPoint",value:function(a){var b=U[0].subVectors(a,this.origin).dot(this.direction);return 0>b?this.origin.distanceToSquared(a):U[0].copy(this.direction).multiplyScalar(b).add(this.origin).distanceToSquared(a)}},{key:"distanceToPoint",value:function(a){return O(this.distanceSquaredToPoint(a))}},{key:"distanceToPlane",value:function(a){var b=a.normal.dot(this.direction),c=0===b?0===a.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(a.normal)+a.constant)/b;return 0<=c?c:null}},{key:"distanceSquaredToSegment",value:function(a,b,d,e){var f,g,h,i,j,k=U[0].copy(a).add(b).multiplyScalar(.5),l=U[1].copy(b).sub(a).normalize(),m=U[2].copy(this.origin).sub(k),n=.5*a.distanceTo(b),o=-this.direction.dot(l),p=m.dot(this.direction),q=-m.dot(l),r=m.lengthSq(),c=L(1-o*o);return 0<c?(f=o*q-p,g=o*p-q,h=n*c,0<=f?g>=-h?g<=h?(i=1/c,f*=i,g*=i,j=f*(f+o*g+2*p)+g*(o*f+g+2*q)+r):(g=n,f=N(0,-(o*g+p)),j=-f*f+g*(g+2*q)+r):(g=-n,f=N(0,-(o*g+p)),j=-f*f+g*(g+2*q)+r):g<=-h?(f=N(0,-(-o*n+p)),g=0<f?-n:M(N(-n,-q),n),j=-f*f+g*(g+2*q)+r):g<=h?(f=0,g=M(N(-n,-q),n),j=g*(g+2*q)+r):(f=N(0,-(o*n+p)),g=0<f?n:M(N(-n,-q),n),j=-f*f+g*(g+2*q)+r)):(g=0<o?-n:n,f=N(0,-(o*g+p)),j=-f*f+g*(g+2*q)+r),void 0!==d&&d.copy(this.direction).multiplyScalar(f).add(this.origin),void 0!==e&&e.copy(l).multiplyScalar(g).add(k),j}},{key:"intersectSphere",value:function(a){var b,c,d,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R,f=U[0].subVectors(a.center,this.origin),g=f.dot(this.direction),h=f.dot(f)-g*g,i=a.radius*a.radius,j=null;return h<=i&&(b=O(i-h),c=g-b,d=g+b,(0<=c||0<=d)&&(j=0>c?this.at(d,e):this.at(c,e))),j}},{key:"intersectsSphere",value:function(a){return this.distanceSqToPoint(a.center)<=a.radius*a.radius}},{key:"intersectPlane",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R,c=this.distanceToPlane(a);return null===c?null:this.at(c,b)}},{key:"intersectsPlane",value:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b}},{key:"intersectBox",value:function(a){var b,c,d,e,f,g,h=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R,i=this.origin,j=this.direction,k=a.min,l=a.max,m=1/j.x,n=1/j.y,o=1/j.z,p=null;return 0<=m?(b=(k.x-i.x)*m,c=(l.x-i.x)*m):(b=(l.x-i.x)*m,c=(k.x-i.x)*m),0<=n?(d=(k.y-i.y)*n,e=(l.y-i.y)*n):(d=(l.y-i.y)*n,e=(k.y-i.y)*n),b<=e&&d<=c&&((d>b||b!==b)&&(b=d),(e<c||c!==c)&&(c=e),0<=o?(f=(k.z-i.z)*o,g=(l.z-i.z)*o):(f=(l.z-i.z)*o,g=(k.z-i.z)*o),b<=g&&f<=c&&((f>b||b!==b)&&(b=f),(g<c||c!==c)&&(c=g),0<=c&&(p=this.at(0<=b?b:c,h)))),p}},{key:"intersectsBox",value:function(a){return null!==this.intersectBox(a,U[0])}},{key:"intersectTriangle",value:function(d,a,b,c,e){var f,g,h,i,j,k=this.direction,l=U[0],m=U[1],n=U[2],o=U[3],p=null;return m.subVectors(a,d),n.subVectors(b,d),o.crossVectors(m,n),f=k.dot(o),0===f||c&&0<f||(0<f?g=1:(g=-1,f=-f),l.subVectors(this.origin,d),h=g*k.dot(n.crossVectors(l,n)),0<=h&&(i=g*k.dot(m.cross(l)),0<=i&&h+i<=f&&(j=-g*l.dot(o),0<=j&&(p=this.at(j/f,e))))),p}},{key:"applyMatrix4",value:function(a){return this.origin.applyMatrix4(a),this.direction.transformDirection(a),this}},{key:"equals",value:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}}]),a}(),W=new R,c=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new R,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,a),this.min=b,this.size=c,this.children=null}return g(a,[{key:"getCenter",value:function(a){return a.copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(a){return a.set(this.size,this.size,this.size)}},{key:"split",value:function(){var a,b,c=this.min,d=this.getCenter(W),e=.5*this.size,f=this.children=[null,null,null,null,null,null,null,null];for(a=0;8>a;++a)b=Q[a],f[a]=new this.constructor(new R(0===b[0]?c.x:d.x,0===b[1]?c.y:d.y,0===b[2]?c.z:d.z),e)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),a}(),X=new R,Y=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new R,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new R;e(this,a),this.min=b,this.max=c,this.children=null}return g(a,[{key:"getCenter",value:function(a){return a.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(a){return a.subVectors(this.max,this.min)}},{key:"split",value:function(){var a,b,c=this.min,d=this.max,e=this.getCenter(X),f=this.children=[null,null,null,null,null,null,null,null];for(a=0;8>a;++a)b=Q[a],f[a]=new this.constructor(new R(0===b[0]?c.x:e.x,0===b[1]?c.y:e.y,0===b[2]?c.z:e.z),new R(0===b[0]?e.x:d.x,0===b[1]?e.y:d.y,0===b[2]?e.z:d.z))}}]),a}(),Z=function a(b,c,d){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;e(this,a),this.distance=b,this.distanceToRay=c,this.point=d,this.object=f},$=function a(){e(this,a),this.value=0},_=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],aa=new R,ba=new T,b=new T,d=new V,r=new $,ca=function(){function a(){e(this,a)}return g(a,null,[{key:"intersectOctree",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],d=y(a,b,r);null!==d&&z.apply(void 0,[a.root].concat(o(d),[c]))}}]),a}(),da=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,c=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];e(this,a),this.value=b,this.done=c}return g(a,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),a}(),ea=new T,fa=function(){function a(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e(this,a),this.octree=b,this.region=c,this.cull=null!==c,this.result=new da,this.trace=null,this.indices=null,this.reset()}return g(a,[{key:"reset",value:function(){var a=this.octree.root;return this.trace=[],this.indices=[],null!==a&&(ea.min=a.min,ea.max=a.max,(!this.cull||this.region.intersectsBox(ea))&&(this.trace.push(a),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var a,b,c,d=this.cull,e=this.region,f=this.indices,g=this.trace,h=null,i=g.length-1;null===h&&0<=i;)if(a=f[i]++,b=g[i].children,!(8>a))g.pop(),f.pop(),--i;else if(null!==b){if(c=b[a],d&&(ea.min=c.min,ea.max=c.max,!e.intersectsBox(ea)))continue;g.push(c),f.push(0),++i}else h=g.pop(),f.pop();return this.result.value=h,this.result.done=null===h,this.result}},{key:"return",value:function(a){return this.result.value=a,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),a}(),ga=new T,ha=function(){function a(b){e(this,a),this.root=b}return g(a,[{key:"getCenter",value:function(a){return this.root.getCenter(a)}},{key:"getDimensions",value:function(a){return this.root.getDimensions(a)}},{key:"cull",value:function(a){var b=[];return B(this.root,a,b),b}},{key:"getDepth",value:function(){return A(this.root)}},{key:"findNodesByLevel",value:function(a){var b=[];return C(this.root,a,0,b),b}},{key:"raycast",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return ca.intersectOctree(this,a.ray,b),b}},{key:"leaves",value:function(a){return new fa(this,a)}},{key:Symbol.iterator,value:function(){return new fa(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),a}(),ia=new R,p=function(a){function b(a,c){var d;return e(this,b),d=l(this,i(b).call(this,a,c)),d.points=null,d.data=null,d}return h(b,a),g(b,[{key:"distanceToSquared",value:function(a){var b=ia.copy(a).clamp(this.min,this.max);return b.sub(a).lengthSquared()}},{key:"distanceToCenterSquared",value:function(a){var b=this.getCenter(ia),c=a.x-b.x,d=a.y-b.x,e=a.z-b.z;return c*c+d*d+e*e}},{key:"contains",value:function(a,b){var c=this.min,d=this.max;return a.x>=c.x-b&&a.y>=c.y-b&&a.z>=c.z-b&&a.x<=d.x+b&&a.y<=d.y+b&&a.z<=d.z+b}},{key:"redistribute",value:function(a){var b,c,d,e,f,g,h,k=this.children,l=this.points,m=this.data;if(null!==k&&null!==l){for(b=0,d=l.length;b<d;++b)for(g=l[b],h=m[b],(c=0,e=k.length);c<e;++c)if(f=k[c],f.contains(g,a)){null===f.points&&(f.points=[],f.data=[]),f.points.push(g),f.data.push(h);break}this.points=null,this.data=null}}},{key:"merge",value:function(){var a=this.children;if(null!==a){var b,c,d,e=[],f=[];for(b=0,c=a.length;b<c;++b)d=a[b],null!==d.points&&(e=e.concat(d.points),f=f.concat(d.data));this.children=null,this.points=e,this.data=f}}}]),b}(Y),ja=function(a){function b(a,c){var d,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,g=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,h=4<arguments.length&&void 0!==arguments[4]?arguments[4]:8;return e(this,b),d=l(this,i(b).call(this,new p(a,c))),d.bias=N(0,f),d.maxPoints=N(1,K(g)),d.maxDepth=N(0,K(h)),d.pointCount=0,d}return h(b,a),g(b,[{key:"countPoints",value:function(a){return D(a)}},{key:"insert",value:function(a,b){return E(a,b,this,this.root,0)}},{key:"remove",value:function(a){return F(a,this,this.root,null)}},{key:"get",value:function(a){return G(a,this,this.root)}},{key:"move",value:function(a,b){return H(a,b,this,this.root,null,0)}},{key:"findNearestPoint",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,c=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],d=I(a,b,c,this.root);return null!==d&&(d.point=d.point.clone()),d}},{key:"findPoints",value:function(a,b){var c=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],d=[];return J(a,b,c,this.root,d),d}},{key:"raycast",value:function(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],d=n(i(b.prototype),"raycast",this).call(this,a);return 0<d.length&&u(d,a,c),c}}]),b}(ha);a.CubicOctant=c,a.Flags=$,a.Octant=Y,a.Octree=ha,a.OctreeIterator=fa,a.OctreeRaycaster=ca,a.PointOctant=p,a.PointOctree=ja,a.RayPointIntersection=Z,a.edges=P,a.findEntryOctant=w,a.findNextOctant=x,a.intersectOctree=y,a.layout=Q,a.testPoints=u,Object.defineProperty(a,"__esModule",{value:!0})});
