/**
 * sparse-octree v6.0.1 build Sat Oct 26 2019
 * https://github.com/vanruesc/sparse-octree
 * Copyright 2019 Raoul van RÃ¼schen, Zlib
 */
"use strict";function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}(function(a,b){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?b(exports,require("math-ds"),require("iterator-result")):"function"==typeof define&&define.amd?define(["exports","math-ds","iterator-result"],b):(a=a||self,b(a.SPARSEOCTREE={},a.MATHDS,a.ITERATORRESULT))})(void 0,function(a,e,f){'use strict';var M=Math.max;function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function h(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function i(a,b,c){return b&&h(a.prototype,b),c&&h(a,c),a}function j(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&l(a,b)}function k(a){return k=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},k(a)}function l(a,b){return l=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},l(a,b)}function m(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function n(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:m(a)}function o(a,b){for(;!Object.prototype.hasOwnProperty.call(a,b)&&(a=k(a),null!==a););return a}function q(a,b,c){return q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(a,b,c){var d=o(a,b);if(d){var e=Object.getOwnPropertyDescriptor(d,b);return e.get?e.get.call(c):e.value}},q(a,b,c||a)}function s(a){return t(a)||u(a)||w()}function t(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function u(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function w(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function x(a,b,c){var f,g,h,k,l,m,n,o,p,q,r,d=Math.sqrt,s=b.params.Points.threshold;for(l=0,n=a.length;l<n;++l)if(p=a[l],q=p.points,null!==q)for(m=0,o=q.length;m<o;++m)r=q[m],k=b.ray.distanceSqToPoint(r),k<s*s&&(f=b.ray.closestPointToPoint(r,new e.Vector3),g=b.ray.origin.distanceTo(f),g>=b.near&&g<=b.far&&(h=d(k),c.push(new S(g,h,f,p.data[m]))))}function y(a,b,c,d,e,f){var g=0;return a>b&&a>c?(e<a&&(g|=2),f<a&&(g|=1)):b>c?(d<b&&(g|=4),f<b&&(g|=1)):(d<c&&(g|=4),e<c&&(g|=2)),g}function z(a,b,c,d){var e,f=0;return b<c?(e=b,f=0):(e=c,f=1),d<e&&(f=2),U[a][f]}function A(a,c,e){var g,h,i,j,k,l,m,n,o,f=Math.min,p=v.min.set(0,0,0),q=v.max.subVectors(a.max,a.min),r=a.getDimensions(b.min),s=b.max.copy(r).multiplyScalar(.5),t=d.origin.copy(c.origin),u=d.direction.copy(c.direction);return t.sub(a.getCenter(V)).add(s),e.value=0,0>u.x&&(t.x=r.x-t.x,u.x=-u.x,e.value|=4),0>u.y&&(t.y=r.y-t.y,u.y=-u.y,e.value|=2),0>u.z&&(t.z=r.z-t.z,u.z=-u.z,e.value|=1),g=1/u.x,h=1/u.y,i=1/u.z,j=(p.x-t.x)*g,k=(q.x-t.x)*g,l=(p.y-t.y)*h,m=(q.y-t.y)*h,n=(p.z-t.z)*i,o=(q.z-t.z)*i,M(M(j,l),n)<f(f(k,m),o)?[j,l,n,k,m,o]:null}function B(a,b,c,d,e,g,h,i){if(0<=e&&0<=g&&0<=h){var j=a.children;if(null===j)i.push(a);else{var k=.5*(b+e),l=.5*(c+g),m=.5*(d+h),n=r.value,f=y(b,c,d,k,l,m);do 0===f?(B(j[n],b,c,d,k,l,m,i),f=z(f,k,l,m)):1===f?(B(j[1^n],b,c,m,k,l,h,i),f=z(f,k,l,h)):2===f?(B(j[2^n],b,l,d,k,g,m,i),f=z(f,k,g,m)):3===f?(B(j[3^n],b,l,m,k,g,h,i),f=z(f,k,g,h)):4===f?(B(j[4^n],k,c,d,e,l,m,i),f=z(f,e,l,m)):5===f?(B(j[5^n],k,c,m,e,l,h,i),f=z(f,e,l,h)):6===f?(B(j[6^n],k,l,d,e,g,m,i),f=z(f,e,g,m)):7===f?(B(j[7^n],k,l,m,e,g,h,i),f=8):void 0;while(8>f)}}}function C(a){var b,c,e,f=a.children,g=0;if(null!==f)for(b=0,c=f.length;b<c;++b)e=1+C(f[b]),e>g&&(g=e);return g}function D(a,b,c){var d,e,f=a.children;if(Z.min=a.min,Z.max=a.max,b.intersectsBox(Z))if(null!==f)for(d=0,e=f.length;d<e;++d)D(f[d],b,c);else c.push(a)}function E(a,b,c,d){var e,f,g=a.children;if(c===b)d.push(a);else if(null!==g)for(++c,e=0,f=g.length;e<f;++e)E(g[e],b,c,d)}function F(a){var b,c,d=a.children,e=0;if(null!==d)for(b=0,c=d.length;b<c;++b)e+=F(d[b]);else null!==a.points&&(e=a.points.length);return e}function G(a,b,c,d,e){var f,g,h=d.children,j=!1,k=!1;if(d.contains(a,c.bias)){if(null===h){if(null===d.points)d.points=[],d.data=[];else for(f=0,g=d.points.length;!j&&f<g;++f)j=d.points[f].equals(a);j?(d.data[f-1]=b,k=!0):d.points.length<c.maxPoints||e===c.maxDepth?(d.points.push(a.clone()),d.data.push(b),++c.pointCount,k=!0):(d.split(),d.redistribute(c.bias),h=d.children)}if(null!==h)for(++e,f=0,g=h.length;!k&&f<g;++f)k=G(a,b,c,h[f],e)}return k}function H(a,b,c,d){var e,f,g,h,j,k=c.children,m=null;if(c.contains(a,b.bias))if(null!==k)for(e=0,f=k.length;null===m&&e<f;++e)m=H(a,b,k[e],c);else if(null!==c.points)for(g=c.points,h=c.data,(e=0,f=g.length);e<f;++e)if(g[e].equals(a)){j=f-1,m=h[e],e<j&&(g[e]=g[j],h[e]=h[j]),g.pop(),h.pop(),--b.pointCount,null!==d&&F(d)<=b.maxPoints&&d.merge();break}return m}function I(a,b,c){var d,e,f,g=c.children,h=null;if(c.contains(a,b.bias))if(null!==g)for(d=0,e=g.length;null===h&&d<e;++d)h=I(a,b,g[d]);else if(null!==c.points)for(f=c.points,d=0,e=f.length;null===h&&d<e;++d)a.equals(f[d])&&(h=c.data[d]);return h}function J(a,b,c,d,e,f){var g,h,j,k=d.children,m=null;if(d.contains(a,c.bias))if(!d.contains(b,c.bias))m=H(a,c,d,e),G(b,m,c,e,f-1);else if(null!==k)for(++f,g=0,h=k.length;null===m&&g<h;++g)m=J(a,b,c,k[g],d,f);else if(null!==d.points)for(j=d.points,g=0,h=j.length;g<h;++g)if(a.equals(j[g])){j[g].copy(b),m=d.data[g];break}return m}function K(a,b,c,d){var e,f,g=null,h=b;if(null!==d.children){var j,k,m=d.children.map(function(b){return{octant:b,distance:b.distanceToCenterSquared(a)}}).sort(function(c,a){return c.distance-a.distance});for(e=0,f=m.length;e<f&&(j=m[e].octant,!(j.contains(a,h)&&(k=K(a,h,c,j),null!==k&&(h=k.distance,g=k,0===h))));++e);}else if(null!==d.points){var n,o=d.points,p=-1;for(e=0,f=o.length;e<f;++e)if(!o[e].equals(a))n=a.distanceTo(o[e]),n<h&&(h=n,p=e);else if(!c){h=0,p=e;break}0<=p&&(g={point:o[p],data:d.data[p],distance:h})}return g}function L(a,b,c,d,e){var f,g,h=d.children;if(null!==h){var j;for(f=0,g=h.length;f<g;++f)j=h[f],j.contains(a,b)&&L(a,b,c,j,e)}else if(null!==d.points){var k,m=d.points;for(f=0,g=m.length;f<g;++f)k=m[f],k.equals(a)?!c&&e.push({point:k.clone(),data:d.data[f]}):k.distanceToSquared(a)<=b*b&&e.push({point:k.clone(),data:d.data[f]})}}f=f&&f.hasOwnProperty("default")?f["default"]:f;var N=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],O=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],P=new e.Vector3,c=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new e.Vector3,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;g(this,a),this.min=b,this.size=c,this.children=null}return i(a,[{key:"getCenter",value:function(a){return a.copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(a){return a.set(this.size,this.size,this.size)}},{key:"split",value:function(){var a,b,c=this.min,d=this.getCenter(P),f=.5*this.size,g=this.children=[null,null,null,null,null,null,null,null];for(a=0;8>a;++a)b=O[a],g[a]=new this.constructor(new e.Vector3(0===b[0]?c.x:d.x,0===b[1]?c.y:d.y,0===b[2]?c.z:d.z),f)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),a}(),Q=new e.Vector3,R=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new e.Vector3,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new e.Vector3;g(this,a),this.min=b,this.max=c,this.children=null}return i(a,[{key:"getCenter",value:function(a){return a.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(a){return a.subVectors(this.max,this.min)}},{key:"split",value:function(){var a,b,c=this.min,d=this.max,f=this.getCenter(Q),g=this.children=[null,null,null,null,null,null,null,null];for(a=0;8>a;++a)b=O[a],g[a]=new this.constructor(new e.Vector3(0===b[0]?c.x:f.x,0===b[1]?c.y:f.y,0===b[2]?c.z:f.z),new e.Vector3(0===b[0]?f.x:d.x,0===b[1]?f.y:d.y,0===b[2]?f.z:d.z))}}]),a}(),S=function a(b,c,d){var e=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;g(this,a),this.distance=b,this.distanceToRay=c,this.point=d,this.object=e},T=function a(){g(this,a),this.value=0},U=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],V=new e.Vector3,v=new e.Box3,b=new e.Box3,d=new e.Ray,r=new T,W=function(){function a(){g(this,a)}return i(a,null,[{key:"intersectOctree",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],d=A(a,b,r);null!==d&&B.apply(void 0,[a.root].concat(s(d),[c]))}}]),a}(),X=new e.Box3,Y=function(){function a(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;g(this,a),this.octree=b,this.region=c,this.cull=null!==c,this.result=new f,this.trace=null,this.indices=null,this.reset()}return i(a,[{key:"reset",value:function(){var a=this.octree.root;return this.trace=[],this.indices=[],null!==a&&(X.min=a.min,X.max=a.max,(!this.cull||this.region.intersectsBox(X))&&(this.trace.push(a),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var a,b,c,d=this.cull,e=this.region,f=this.indices,g=this.trace,h=null,i=g.length-1;null===h&&0<=i;)if(a=f[i]++,b=g[i].children,!(8>a))g.pop(),f.pop(),--i;else if(null!==b){if(c=b[a],d&&(X.min=c.min,X.max=c.max,!e.intersectsBox(X)))continue;g.push(c),f.push(0),++i}else h=g.pop(),f.pop();return this.result.value=h,this.result.done=null===h,this.result}},{key:"return",value:function(a){return this.result.value=a,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),a}(),Z=new e.Box3,$=function(){function a(b){g(this,a),this.root=b}return i(a,[{key:"getCenter",value:function(a){return this.root.getCenter(a)}},{key:"getDimensions",value:function(a){return this.root.getDimensions(a)}},{key:"cull",value:function(a){var b=[];return D(this.root,a,b),b}},{key:"getDepth",value:function(){return C(this.root)}},{key:"findNodesByLevel",value:function(a){var b=[];return E(this.root,a,0,b),b}},{key:"raycast",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return W.intersectOctree(this,a.ray,b),b}},{key:"leaves",value:function(a){return new Y(this,a)}},{key:Symbol.iterator,value:function(){return new Y(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),a}(),_=new e.Vector3,p=function(a){function b(a,c){var d;return g(this,b),d=n(this,k(b).call(this,a,c)),d.points=null,d.data=null,d}return j(b,a),i(b,[{key:"distanceToSquared",value:function(a){var b=_.copy(a).clamp(this.min,this.max);return b.sub(a).lengthSquared()}},{key:"distanceToCenterSquared",value:function(a){var b=this.getCenter(_),c=a.x-b.x,d=a.y-b.x,e=a.z-b.z;return c*c+d*d+e*e}},{key:"contains",value:function(a,b){var c=this.min,d=this.max;return a.x>=c.x-b&&a.y>=c.y-b&&a.z>=c.z-b&&a.x<=d.x+b&&a.y<=d.y+b&&a.z<=d.z+b}},{key:"redistribute",value:function(a){var b,c,d,e,f,g,h,k=this.children,l=this.points,m=this.data;if(null!==k&&null!==l){for(b=0,d=l.length;b<d;++b)for(g=l[b],h=m[b],(c=0,e=k.length);c<e;++c)if(f=k[c],f.contains(g,a)){null===f.points&&(f.points=[],f.data=[]),f.points.push(g),f.data.push(h);break}this.points=null,this.data=null}}},{key:"merge",value:function(){var a=this.children;if(null!==a){var b,c,d,e=[],f=[];for(b=0,c=a.length;b<c;++b)d=a[b],null!==d.points&&(e=e.concat(d.points),f=f.concat(d.data));this.children=null,this.points=e,this.data=f}}}]),b}(R),aa=function(a){function b(a,c){var e,d=Math.round,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,h=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:8;return g(this,b),e=n(this,k(b).call(this,new p(a,c))),e.bias=M(0,f),e.maxPoints=M(1,d(h)),e.maxDepth=M(0,d(i)),e.pointCount=0,e}return j(b,a),i(b,[{key:"countPoints",value:function(a){return F(a)}},{key:"insert",value:function(a,b){return G(a,b,this,this.root,0)}},{key:"remove",value:function(a){return H(a,this,this.root,null)}},{key:"get",value:function(a){return I(a,this,this.root)}},{key:"move",value:function(a,b){return J(a,b,this,this.root,null,0)}},{key:"findNearestPoint",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,c=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],d=K(a,b,c,this.root);return null!==d&&(d.point=d.point.clone()),d}},{key:"findPoints",value:function(a,b){var c=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],d=[];return L(a,b,c,this.root,d),d}},{key:"raycast",value:function(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],d=q(k(b.prototype),"raycast",this).call(this,a);return 0<d.length&&x(d,a,c),c}}]),b}($);a.CubicOctant=c,a.Flags=T,a.Octant=R,a.Octree=$,a.OctreeIterator=Y,a.OctreeRaycaster=W,a.PointOctant=p,a.PointOctree=aa,a.RayPointIntersection=S,a.edges=N,a.findEntryOctant=y,a.findNextOctant=z,a.intersectOctree=A,a.layout=O,a.testPoints=x,Object.defineProperty(a,"__esModule",{value:!0})});
